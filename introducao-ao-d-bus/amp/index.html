<!DOCTYPE html>
<html ⚡>
<head>
    <meta charset="utf-8">

    <title>Introdução ao D-Bus</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <meta name="description" content="Apresentando conceitos e demonstrando na prática as aplicações do sistema de comunicação entre processos" />
    <link rel="shortcut icon" href="/favicon.png" type="image/png" />
    <link rel="canonical" href="https://radialle.com/introducao-ao-d-bus/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="Radialle" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Introdução ao D-Bus" />
    <meta property="og:description" content="Apresentando conceitos e demonstrando na prática as aplicações do sistema de comunicação entre processos" />
    <meta property="og:url" content="https://radialle.com/introducao-ao-d-bus/" />
    <meta property="og:image" content="https://radialle.com/content/images/2020/04/0-Ruq2GfPiSH8Oe_09..png" />
    <meta property="article:published_time" content="2017-11-27T03:00:00.000Z" />
    <meta property="article:modified_time" content="2020-04-05T01:32:50.000Z" />
    <meta property="article:tag" content="Software" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Introdução ao D-Bus" />
    <meta name="twitter:description" content="Apresentando conceitos e demonstrando na prática as aplicações do sistema de comunicação entre processos" />
    <meta name="twitter:url" content="https://radialle.com/introducao-ao-d-bus/" />
    <meta name="twitter:image" content="https://radialle.com/content/images/2020/04/0-Ruq2GfPiSH8Oe_09..png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Rodrigo Laneth" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Software" />
    <meta name="twitter:creator" content="@rlaneth" />
    <meta property="og:image:width" content="800" />
    <meta property="og:image:height" content="400" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Radialle",
        "url": "https://radialle.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://radialle.com/content/images/2020/04/blog-icon.svg"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Rodrigo Laneth",
        "image": {
            "@type": "ImageObject",
            "url": "https://radialle.com/content/images/2020/04/Unknown-2.jpeg",
            "width": 640,
            "height": 640
        },
        "url": "https://radialle.com/author/rlaneth/",
        "sameAs": [
            "https://rlaneth.com",
            "https://twitter.com/rlaneth"
        ]
    },
    "headline": "Introdução ao D-Bus",
    "url": "https://radialle.com/introducao-ao-d-bus/",
    "datePublished": "2017-11-27T03:00:00.000Z",
    "dateModified": "2020-04-05T01:32:50.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://radialle.com/content/images/2020/04/0-Ruq2GfPiSH8Oe_09..png",
        "width": 800,
        "height": 400
    },
    "keywords": "Software",
    "description": "Apresentando conceitos e demonstrando na prática as aplicações do sistema de comunicação entre processos",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://radialle.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.12" />
    <link rel="alternate" type="application/rss+xml" title="Radialle" href="https://radialle.com/rss/" />

    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,600,400" />
    <style amp-custom>html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{margin:0.67em 0;font-size:2em}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{position:relative;vertical-align:baseline;font-size:75%;line-height:0}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}amp-img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace, monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;color:inherit;font:inherit}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{cursor:pointer;-webkit-appearance:button}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{margin:0 2px;padding:0.35em 0.625em 0.75em;border:1px solid #c0c0c0}legend{padding:0;border:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}html{max-height:100%;height:100%;font-size:62.5%;-webkit-tap-highlight-color:rgba(0, 0, 0, 0)}body{max-height:100%;height:100%;color:#3a4145;background:#f4f8fb;letter-spacing:0.01rem;font-family:"Merriweather", serif;font-size:1.8rem;line-height:1.75em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{margin:0 0 0.3em 0;color:#2e2e2e;font-family:"Open Sans", sans-serif;line-height:1.15em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1;-moz-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1;-o-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1}h1{text-indent:-2px;letter-spacing:-1px;font-size:2.6rem}h2{letter-spacing:0;font-size:2.4rem}h3{letter-spacing:-0.6px;font-size:2.1rem}h4{font-size:1.9rem}h5{font-size:1.8rem}h6{font-size:1.8rem}a{color:#4a4a4a}a:hover{color:#111}p,ul,ol,dl{margin:0 0 2.5rem 0;font-size:1.5rem;text-rendering:geometricPrecision;-webkit-font-feature-settings:"liga" 1, "onum" 1, "kern" 1;-moz-font-feature-settings:"liga" 1, "onum" 1, "kern" 1;-o-font-feature-settings:"liga" 1, "onum" 1, "kern" 1}ol,ul{padding-left:2em}ol ol,ul ul,ul ol,ol ul{margin:0 0 0.4em 0;padding-left:2em}dl dt{float:left;clear:left;overflow:hidden;margin-bottom:1em;width:180px;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd{margin-bottom:1em;margin-left:200px}li{margin:0.4em 0}li li{margin:0}hr{display:block;margin:1.75em 0;padding:0;height:1px;border:0;border-top:#efefef 1px solid}blockquote{box-sizing:border-box;margin:1.75em 0 1.75em 0;padding:0 0 0 1.75em;border-left:#4a4a4a 0.4em solid;-moz-box-sizing:border-box}blockquote p{margin:0.8em 0;font-style:italic}blockquote small{display:inline-block;margin:0.8em 0 0.8em 1.5em;color:#ccc;font-size:0.9em}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:normal}mark{background-color:#fdffb6}code,tt{padding:1px 3px;border:#e3edf3 1px solid;background:#f7fafb;border-radius:2px;white-space:pre-wrap;font-family:Inconsolata, monospace, sans-serif;font-size:0.85em;font-feature-settings:"liga" 0;-webkit-font-feature-settings:"liga" 0;-moz-font-feature-settings:"liga" 0}pre{overflow:auto;box-sizing:border-box;margin:0 0 1.75em 0;padding:10px;width:100%;border:#e3edf3 1px solid;background:#f7fafb;border-radius:3px;white-space:pre;font-family:Inconsolata, monospace, sans-serif;font-size:0.9em;-moz-box-sizing:border-box}pre code,pre tt{padding:0;border:none;background:transparent;white-space:pre-wrap;font-size:inherit}kbd{display:inline-block;margin-bottom:0.4em;padding:1px 8px;border:#ccc 1px solid;background:#f4f4f4;border-radius:4px;box-shadow:0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 0 #fff inset;color:#666;text-shadow:#fff 0 1px 0;font-size:0.9em;font-weight:700}table{box-sizing:border-box;margin:1.75em 0;max-width:100%;width:100%;background-color:transparent;-moz-box-sizing:border-box}table th,table td{padding:8px;border-top:#efefef 1px solid;vertical-align:top;text-align:left;line-height:20px}table th{color:#000}table caption + thead tr:first-child th,table caption + thead tr:first-child td,table colgroup + thead tr:first-child th,table colgroup + thead tr:first-child td,table thead:first-child tr:first-child th,table thead:first-child tr:first-child td{border-top:0}table tbody + tbody{border-top:#efefef 2px solid}table table table{background-color:#fff}table tbody > tr:nth-child(odd) > td,table tbody > tr:nth-child(odd) > th{background-color:#f6f6f6}table.plain tbody > tr:nth-child(odd) > td,table.plain tbody > tr:nth-child(odd) > th{background:transparent}iframe,amp-iframe,.fluid-width-video-wrapper{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper amp-iframe{margin:0}textarea,select,input{margin:0 0 5px 0;padding:6px 9px;width:260px;outline:0;border:#e7eef2 1px solid;background:#fff;border-radius:4px;box-shadow:none;font-family:"Open Sans", sans-serif;font-size:1.6rem;line-height:1.4em;font-weight:100;-webkit-appearance:none}textarea{min-width:250px;min-height:80px;max-width:340px;width:100%;height:auto}input[type="text"]:focus,input[type="email"]:focus,input[type="search"]:focus,input[type="tel"]:focus,input[type="url"]:focus,input[type="password"]:focus,input[type="number"]:focus,input[type="date"]:focus,input[type="month"]:focus,input[type="week"]:focus,input[type="time"]:focus,input[type="datetime"]:focus,input[type="datetime-local"]:focus,textarea:focus{outline:none;outline-width:0;border:#bbc7cc 1px solid;background:#fff}select{width:270px;height:30px;line-height:30px}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.main-header{position:relative;display:table;overflow:hidden;box-sizing:border-box;width:100%;height:50px;background:#5ba4e5 no-repeat center center;background-size:cover;text-align:left;-webkit-box-sizing:border-box;-moz-box-sizing:border-box}.content{background:#fff;padding-top:15px}.blog-title,.content{margin:auto;max-width:600px}.blog-title a{display:block;padding-right:16px;padding-left:16px;height:50px;color:#fff;text-decoration:none;font-family:"Open Sans", sans-serif;font-size:16px;line-height:50px;font-weight:600}.post{position:relative;margin-top:0;margin-right:16px;margin-left:16px;padding-bottom:0;max-width:100%;border-bottom:#ebf2f6 1px solid;word-wrap:break-word;font-size:0.95em;line-height:1.65em}.post-header{margin-bottom:1rem}.post-title{margin-bottom:0}.post-title a{text-decoration:none}.post-meta{display:block;margin:3px 0 0 0;color:#9eabb3;font-family:"Open Sans", sans-serif;font-size:1.3rem;line-height:2.2rem}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.post-meta .author{margin:0;font-size:1.3rem;line-height:1.3em}.post-date{display:inline-block;text-transform:uppercase;white-space:nowrap;font-size:1.2rem;line-height:1.2em}.post-image{margin:0;padding-top:3rem;padding-bottom:30px;border-top:1px #E8E8E8 solid}.post-content amp-img,.post-content amp-anim{position:relative;left:50%;display:block;padding:0;min-width:0;max-width:112%;width:calc(100% + 32px);height:auto;transform:translateX(-50%);-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%)}.footnotes{font-size:1.3rem;line-height:1.6em;font-style:italic}.footnotes li{margin:0.6rem 0}.footnotes p{margin:0}.footnotes p a:last-child{text-decoration:none}.site-footer{position:relative;margin:0 auto 20px auto;padding:1rem 15px;max-width:600px;color:rgba(0,0,0,0.5);font-family:"Open Sans", sans-serif;font-size:1.1rem;line-height:1.75em}.site-footer a{color:rgba(0,0,0,0.5);text-decoration:none;font-weight:bold}.site-footer a:hover{border-bottom:#bbc7cc 1px solid}.poweredby{display:block;float:right;width:45%;text-align:right}.copyright{display:block;float:left;width:45%}</style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="main-header">
        <nav class="blog-title">
            <a href="https://radialle.com">Radialle</a>
        </nav>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Introdução ao D-Bus</h1>
                <section class="post-meta">
                    <p class="author">by <a href="/author/rlaneth/">Rodrigo Laneth</a></p>
                    <time class="post-date" datetime="2017-11-27">2017-11-27</time>
                </section>
            </header>
            <figure class="post-image">
                <amp-img src="https://radialle.com/content/images/2020/04/0-Ruq2GfPiSH8Oe_09..png" width="600" height="400" layout="responsive"></amp-img>
            </figure>
            <section class="post-content">

                <p>O <a href="https://www.freedesktop.org/wiki/Software/dbus/" rel="noopener">D-Bus</a> é um sistema de IPC (<em><em>Inter-Process Communication</em></em>, ou comunicação entre processos) criado e mantido como parte do <a href="https://www.freedesktop.org/" rel="noopener">freedesktop.org</a>, projeto dedicado à interoperabilidade e ao desenvolvimento de tecnologias compartilhadas entre os ambientes gráficos para o <a href="https://www.x.org/" rel="noopener">X Window System</a>, incluindo os populares <a href="https://www.gnome.org/" rel="noopener">GNOME</a> e<a href="https://www.kde.org/" rel="noopener"> KDE</a>.</p><p>Criado para atender às necessidades desses dois últimos, o D-Bus é, hoje, utilizado por vários outros projetos, incluindo o servidor de áudio <a href="https://www.freedesktop.org/wiki/Software/PulseAudio/" rel="noopener">PulseAudio</a> e a <em><em>stack</em></em> Bluetooth <a href="http://www.bluez.org/" rel="noopener">BlueZ</a>. Além disso, os <em><em>bindings</em></em> existentes para as mais diversas linguagens de programação facilitam bastante a sua adoção.</p><p>A proposta deste texto é apresentar os conceitos básicos e demonstrar como um desenvolvedor pode fazer uso do sistema. Portanto, não se trata de uma abordagem minuciosa dos detalhes referentes ao seu funcionamento. Materiais recomendados para um maior aprofundamento no tema podem ser encontrados ao final do texto, nas seções “Indo Além” e “Referências”.</p><h1 id="conceitos">Conceitos</h1><p>Muitos dos termos utilizados no âmbito da OOP (<em><em>Object-Oriented Programming</em></em>, ou programação orientada a objetos), como, por exemplo, “objeto” e “método”, são também aplicados ao D-Bus, muito embora para nomear conceitos distintos. Desta forma, é necessário atenção para não confundir os significados.</p><h2 id="bus">Bus</h2><p>Podemos descrever um <em><em>bus</em></em> como um canal através do qual programas se comunicam. Geralmente, e a depender do ambiente analisado, há, por padrão, um <em><em>system bus</em></em>, único e destinado à troca de informações entre todo o sistema operacional, e um <em><em>session bus</em></em> para cada sessão de usuário ativa, onde os dados trafegados se restrigem a ela.</p><p>Cada <em><em>bus</em></em> possui um endereço para acesso, que frequentemente é o caminho de um <em><em>Unix-domain socket</em></em> (soquete de domínio Unix). No entanto, outros esquemas de comunicação podem ser utilizados. É possível, por exemplo, que um <em><em>bus</em></em> esteja associado a uma porta TCP, sendo, assim, acessível por meio do endereço dela.</p><h2 id="bus-name">Bus Name</h2><p>Os <em><em>bus names</em></em> são nomes atribuídos às conexões dos programas a um <em><em>bus</em></em>. São divididos em dois tipos: <em><em>unique connection names</em></em> (nomes únicos de conexão) e <em><em>well-known names</em></em> (nomes conhecidos).</p><p>Os <em><em>unique connection names</em></em> são únicos e imutáveis, atribuídos a cada conexão no momento em que elas são estabelecidas e nunca reutilizados no mesmo <em><em>bus</em></em> ao longo de todo o tempo em que ele existir, mesmo que as conexões a que eles estão associados se encerrem. Se iniciam com dois pontos (“:”), uma característica exclusiva, que não pode ser imitada pelos <em><em>well-known names</em></em>. Exemplo: <strong><strong>:1.72</strong></strong>.</p><p>Os <em><em>well-known names</em></em> são nomes atribuídos às conexões por solicitação dos programas. Constituem-se de dois ou mais elementos separados por pontos (“.”). Por convenção, adotam o formato de nomes de domínio revertidos. Exemplo: <strong><strong>com.radialle.app</strong></strong>.</p><p>Deve-se ressaltar que o termo “<em><em>bus name</em></em>” <strong><strong>não</strong></strong> se refere ao “nome de um <em><em>bus</em></em>”, ainda que possa sugerir esta ideia.</p><h2 id="objeto">Objeto</h2><p>Uma das pontas de qualquer comunicação realizada através do D-Bus é um <em><em>objeto</em></em>, elemento de um programa que se torna acessível aos demais ao ser registrado em um <em><em>bus</em></em>.</p><p>Cada objeto é identificado por um <em><em>object path</em></em> (caminho de objeto) como, por exemplo, <strong><strong>/com/radialle/app/example</strong></strong>. Pelos padrões que seguem, os <em><em>object paths</em></em> se assemelham aos caminhos de sistemas de arquivos em estilo Unix. No entanto, ao contrário do que poderia-se pensar, eles não necessariamente indicam relações hierárquicas.</p><p>Os objetos existem dentro do contexto de uma conexão. Para acessá-los, é necessário conhecer o <em><em>bus name</em></em> ao qual o objeto desejado está associado, bem como o seu <em><em>object path</em></em>. Assim, um <em><em>object path</em></em> precisa ser único dentro de uma mesma conexão, embora possa se repetir no <em><em>bus</em></em>.</p><p>Em todo <em><em>bus</em></em>, há um objeto que representa o próprio <em><em>bus</em></em>. Ele é disponibilizado através conexão de <em><em>bus name</em></em> <strong><strong>org.freedesktop.DBus</strong></strong> e o seu <em><em>object path</em></em> é <strong><strong>/</strong></strong>. Dentre as suas funções, estão a de possibilitar a solicitação de <em><em>well-known names</em></em> e a de permitir que os programas conectados descubram as demais conexões ativas ao <em><em>bus</em></em>.</p><h2 id="proxy">Proxy</h2><p>Um <em><em>proxy</em></em> é uma representação de um objeto registrado em um <em><em>bus</em></em> que existe somente dentro de um programa, sendo de exclusiva responsabilidade do <em><em>binding</em></em> utilizado.</p><p>Em muitos <em><em>bindings</em></em>, o <em><em>proxy</em></em> tem a forma de um objeto nativo da linguagem de programação utilizada, permitindo que o desenvolvedor acesse um objeto do D-Bus de maneira muito similar a como faria com um objeto regular.</p><h2 id="m-todo">Método</h2><p>Os métodos são associados a objetos, e representam operações de um programa que podem ser chamadas pelos demais processos conectados ao mesmo <em><em>bus</em></em>. Assim como as tradicionais funções das linguagens de programação, ou mesmo os métodos da OOP, eles podem requerer argumentos (<em><em>input parameters</em></em>, ou parâmetros de entrada) e retornar dados (<em><em>output parameters</em></em>, ou parâmetros de saída). Se ocorrer um erro durante a execução da operação, eles podem também retornar uma <em><em>exceção</em></em> contendo um nome e uma mensagem de erro.</p><p>Muitos detalhes costumam ser simplificados pelos <em><em>bindings</em></em>. É comum, por exemplo, que a chamada de um método através de um <em><em>proxy</em></em> seja efetuada com argumentos de entrada de tipos nativos da linguagem de programação utilizada, com o processo de conversão para os tipos suportados pelo D-Bus ficando sob responsabilidade da biblioteca. Similarmente, os parâmetros de saída e as exceções do D-Bus também podem ser convertidos para as suas contrapartes nativas, possibilitando o tratamento pelo desenvolvedor da maneira convencional.</p><h2 id="sinal">Sinal</h2><p><em><em>Sinais</em></em> (<em><em>signals</em></em>) são um mecanismo através do qual um objeto pode enviar, a qualquer momento, informações aos programas conectados ao <em><em>bus</em></em>.</p><p>É importante notar, no entanto, que os sinais não são automaticamente recebidos por todos os programas conectados ao <em><em>bus</em></em>; eles precisam se registrar para recebê-los, especificando os sinais desejados. Há, portanto, a possibilidade de um sinal ser emitido sem que existam destinatários registrados e não ser recebido por qualquer conexão.</p><h2 id="interface">Interface</h2><p>Uma interface especifica um conjunto de <em><em>membros</em></em> — ou seja, métodos e sinais — que pode ser implementado por um objeto. A implementação de uma interface é uma promessa de que o objeto conterá todos os membros definidos por ela.</p><p>Diversos objetos podem implementar uma mesma interface, bem como múltiplas interfaces podem ser implementadas por um único objeto. Se membros idênticos forem definidos por duas ou mais interfaces implementadas pelo objeto, um programa que tente acessar qualquer um deles utilizando somente o <em><em>object path</em></em> e o nome não terá qualquer garantia sobre qual será efetivamente acessado. Para evitar este problema, é importante que se especifique, também, a interface à qual pertence o membro desejado.</p><h2 id="propriedade">Propriedade</h2><p>As <em><em>propriedades</em></em> são associadas aos objetos e dedicadas ao armazenamento de informações. Elas podem ser lidas ou modificadas, a depender das permissões que lhe foram atribuídas, pelos programas conectados ao <em><em>bus</em></em>.</p><p>A descoberta e o acesso às propriedades são realizados por meio de membros dos objetos. Uma leitura simples do valor contido em uma delas, por exemplo, seria efetuada através de uma chamada ao método <strong><strong>Get</strong></strong> da interface <strong><strong>org.freedesktop.DBus.Properties</strong></strong>, implementada pelo mesmo objeto ao qual a propriedade estivesse associada.</p><h1 id="pr-tica">Prática</h1><p>Esclarecidos os conceitos básicos relacionados ao D-Bus, devemos passar à prática para fixar o conhecimento e adquirir uma melhor compreensão das possibilidades que o sistema oferece.</p><p>Para os fins deste texto, usaremos exemplos escritos em Python 3.x, que utilizam o <em><em>binding</em></em> <a href="https://github.com/LEW21/pydbus" rel="noopener">pydbus</a> e foram testados em uma instalação do Debian 9 “Stretch”. Eles devem, no entanto, funcionar na maioria dos ambientes Linux, desde que sejam observados os requerimentos do pydbus — inclusive a necessidade da GLib 2.46 e do girepository 1.46 ou superiores para registrar objetos em um <em><em>bus</em></em> — , do interpretador Python e do próprio D-Bus.</p><h2 id="pydbus">pydbus</h2><p>Em sua página do GitHub, o pydbus é definido como uma biblioteca “pythônica” para o D-Bus. Seu <a href="https://github.com/LEW21/pydbus" rel="noopener"><em><em>README</em></em></a> é simples e direto, contendo diversos exemplos de uso básico do <em><em>binding</em></em>. No mesmo repositório há, ainda, um <a href="https://github.com/LEW21/pydbus/blob/master/doc/tutorial.rst" rel="noopener">tutorial</a> com informações mais detalhadas e outros <em><em>scripts</em></em> de demonstração. Muito embora essas leituras não sejam obrigatórias para a compreensão do restante deste texto, elas são, sem dúvida, recomendadas.</p><h2 id="mpris">MPRIS</h2><p>Para facilitar a integração de <em><em>players</em></em> de mídia com outros programas através do D-Bus, foi criada a <a href="https://specifications.freedesktop.org/mpris-spec/latest/" rel="noopener">MPRIS</a> (<em><em>Media Player Remote Interfacing Specification</em></em>).</p><p>Ao definir convenções para a escolha de <em><em>bus names</em></em>, determinar os objetos que devem existir, seus <em><em>paths</em></em>, as interfaces que devem implementar, dentre outros padrões, a especificação simplifica o desenvolvimento de programas que fazem uso das informações e dos serviços oferecidos pelas aplicações dedicadas à reprodução de áudio e vídeo.</p><p>Como exemplo, podemos destacar que a MPRIS, desde a sua versão 2.0 até a 2.2 — a mais recente disponível no momento da elaboração deste texto — determina o uso de um <em><em>unique connection name</em></em> iniciado por <strong><strong>org.mpris.MediaPlayer2.</strong></strong>, o que torna possível obter uma lista de <em><em>players</em></em>compatíveis conectados a um <em><em>bus</em></em> através da aquisição e filtragem de uma lista completa de <em><em>bus names</em></em>.</p><h2 id="pdmtools">pdmtools</h2><p>O <a href="https://github.com/rapidlight/pdmtools" rel="noopener">pdmtools</a> é um conjunto de duas ferramentas em Python criadas especificamente para acompanhar este texto, servindo como exemplo prático do uso do pydbus para interação com outros programas via D-Bus.</p><p>A primeira delas, chamada lsmpris, exibe uma lista contendo os nomes e os <em><em>bus names</em></em> dos <em><em>players</em></em> compatíveis com a MPRIS 2.x conectados ao <em><em>bus</em></em>especificado.</p><p>A segunda, nomeada fakeplayer, simula um <em><em>player</em></em> compatível ao solicitar um <em><em>bus name</em></em> iniciado por <strong><strong>org.mpris.MediaPlayer2.</strong></strong> e registrar um objeto com o <em><em>path</em></em> <strong><strong>/org/mpris/MediaPlayer2</strong></strong> contendo a propriedade <strong><strong>Identity</strong></strong>. Obviamente, esta é a implementação de apenas um pequeno fragmento da MPRIS, útil somente para fins de estudo e para <em><em>debugging</em></em> da lsmpris.</p><h2 id="ferramentas-do-d-bus">Ferramentas do D-Bus</h2><p>Os <em><em>releases</em></em> do D-Bus incluem ferramentas de linha de comando destinadas à interação com o sistema. Dentre elas, encontram-se a <a href="https://dbus.freedesktop.org/doc/dbus-send.1.html" rel="noopener">dbus-send</a>, que possibilita o envio de mensagens aos objetos especificados, e a <a href="https://dbus.freedesktop.org/doc/dbus-monitor.1.html" rel="noopener">dbus-monitor</a>, para monitoramento das informações trafegadas em um <em><em>bus</em></em>.</p><p>Vemos, a seguir, um exemplo de utilização da dbus-send. Nele, a ferramenta é usada para chamar o método <strong><strong>Get</strong></strong> da interface <strong><strong>org.freedesktop.DBus.Properties</strong></strong>, implementada pelo objeto <strong><strong>/org/mpris/MediaPlayer2</strong></strong> associado à conexão que utiliza o <em><em>bus name</em></em><strong><strong>org.mpris.MediaPlayer2.fakeplayer</strong></strong>. Especificam-se, como parâmetros de entrada, as strings “org.mpris.MediaPlayer2” e “Identity”, que correspondem, respectivamente, à interface e ao nome da propriedade cujo valor deseja-se obter.</p><pre><code>dbus-send \
--print-reply \
--dest=org.mpris.MediaPlayer2.fakeplayer \
/org/mpris/MediaPlayer2 \
org.freedesktop.DBus.Properties.Get \
string:"org.mpris.MediaPlayer2" string:"Identity"
</code></pre>
<p>Uma das tarefas que podem ser cumpridas com a dbus-monitor é, conforme demonstrado a seguir, a observação dos sinais emitidos por uma determinada conexão. A ferramenta é chamada com um filtro como parâmetro, de maneira que as únicas mensagens trocadas através do <em><em>bus</em></em> a serem exibidas por ela sejam os sinais originados da conexão de <em><em>bus name</em></em><strong><strong>org.mpris.MediaPlayer2.vlc</strong></strong>, normalmente associada a uma instância do <a href="https://www.videolan.org/vlc/" rel="noopener">VLC media player</a>.</p><pre><code>dbus-monitor \
"type='signal',sender='org.mpris.MediaPlayer2.vlc'"
</code></pre>
<p>Nos dois exemplos anteriores, não é especificado um <em><em>bus</em></em> ao qual as ferramentas devem se conectar. Para este caso, ambas adotam como padrão o uso do <em><em>session bus</em></em>.</p><h2 id="d-feet">D-Feet</h2><p>Ainda que a possibilidade de interagir com o D-Bus diretamente pela linha de comando seja bastante útil, inclusive para automatização com <em><em>shell scripts</em></em>, não se trata de uma maneira fácil de explorar e compreender as conexões ativas a um <em><em>bus</em></em>, os objetos associados a elas, seus métodos, sinais e propriedades. Uma melhor alternativa é o <a href="https://wiki.gnome.org/Apps/DFeet" rel="noopener">D-Feet</a>, um <em><em>software</em></em> com interface gráfica dedicado às tarefas de <em><em>debugging</em></em> relacionadas ao D-Bus e mantido como parte do projeto GNOME.</p><figure class="kg-card kg-image-card"></figure><p>Por padrão, o D-Feet exibe, no topo de sua janela principal, as abas “System Bus” e “Session Bus”, que, como os nomes indicam, correspondem, respectivamente, ao <em><em>system bus</em></em> e ao <em><em>session bus</em></em> da sessão de usuário ativa. No canto superior direito, um botão hambúrguer dá acesso às opções de conectar a ferramenta a um outro <em><em>bus</em></em>, ou encerrar uma conexão existente.</p><p>Ao lado esquerdo da mesma janela, existe uma lista de <em><em>bus names</em></em>, correspondente à aba selecionada. Clicando sobre um dos itens, surge, do lado direito, uma lista com os objetos associados à conexão e todas as informações referentes a eles.</p><figure class="kg-card kg-image-card"></figure><p>No exemplo acima, vemos o D-Feet exibir o único objeto criado pela fakeplayer, de <em><em>object path</em></em> <strong><strong>/org/mpris/MediaPlayer2</strong></strong>, que, por sua vez, define a propriedade <strong><strong>Identity</strong></strong>, com permissão somente de leitura. Foi efetuado um duplo clique sobre o seu nome para que o valor associado fosse exibido: “Fake Player”.</p><p>Nota-se que a aplicação simplifica o acesso às propriedades, invocando o método e exibindo os resultados de maneira transparente para o usuário. No entanto, como ela também permite chamar métodos, podemos usá-la para acionar o <strong><strong>Get</strong></strong> da interface <strong><strong>org.freedesktop.DBus.Properties</strong></strong>manualmente, se assim desejarmos.</p><figure class="kg-card kg-image-card"></figure><p>Uma das funções que não faz parte da ferramenta até a mais recente versão disponível durante a elaboração deste texto (0.3.11) é a de receber os sinais emitidos, muito embora ela permita visualizar quais deles são definidos pelas interfaces que os objetos implementam.</p><h1 id="indo-al-m">Indo Além</h1><p>Há aspectos mais avançados do D-Bus que, apesar de não detalhados neste texto, merecem ser mencionados, uma vez que podem ser bastante úteis para aqueles que pretendem se aprofundar na utilização do sistema.</p><h2 id="ativa-o">Ativação</h2><p>Um programa com suporte à <em><em>ativação</em></em> via D-Bus não precisa permanecer em execução para receber as mensagens a ele direcionadas; o sistema se encarregará de chamá-lo quando for solicitado.</p><p>O desenvolvimento de um <em><em>software</em></em> compatível com esse recurso envolve a criação de uma <em><em>service file</em></em>, que fornece ao D-Bus informações como o caminho para o programa a ser executado e o <em><em>bus name</em></em> a ser utilizado.</p><p>Detalhes podem ser encontrados em documentos como o tutorial “<a href="https://techbase.kde.org/Development/Tutorials/D-Bus/Autostart_Services" rel="noopener"><em><em>Creating and Installing D-Bus Autostart Services</em></em></a>”, publicado na <a href="https://techbase.kde.org/Welcome_to_KDE_TechBase" rel="noopener">KDE TechBase</a>.</p><h2 id="seguran-a">Segurança</h2><p>Há diversos recursos para ajudar a garantir a segurança dos programas conectados e das informações trocadas por meio do D-Bus.</p><p>O sistema permite que se configure um <em><em>bus</em></em> para requerer autenticação, de forma que aplicações não possam se conectar a ele sem apresentar as credenciais adequadas. Também é possível aplicar uma <em><em>security policy </em></em>(política de segurança), o que permite a filtragem dos dados trafegados por características como origem, destinatário e conteúdo.</p><p>Normalmente, o <em><em>system bus</em></em> adota, por padrão, uma política de segurança bastante restritiva, impedindo, por exemplo, a solicitação de <em><em>bus names</em></em> e a chamada de qualquer método por processos que não tenham sido explicitamente autorizados.</p><p>Mais informações a respeito podem ser encontradas na documentação do <a href="https://dbus.freedesktop.org/doc/dbus-daemon.1.html" rel="noopener">dbus-daemon</a>.</p><h1 id="refer-ncias">Referências</h1><ul><li>“<a href="https://dbus.freedesktop.org/doc/dbus-specification.html" rel="noopener"><em><em>D-Bus Specification</em></em></a>”, especificação do D-Bus</li><li>“<a href="https://www.freedesktop.org/wiki/IntroductionToDBus/" rel="noopener"><em><em>Introduction to D-Bus</em></em></a>”, parte da documentação oficial</li><li>“<a href="https://dbus.freedesktop.org/doc/dbus-tutorial.html" rel="noopener"><em><em>D-Bus Tutorial</em></em></a>”, tutorial oficial</li><li>“<a href="https://pythonhosted.org/txdbus/dbus_overview.html" rel="noopener"><em><em>D-Bus Overview</em></em></a>”, parte do projeto Tx DBus</li><li>“<a href="https://dbus.freedesktop.org/doc/dbus-daemon.1.html" rel="noopener"><em><em>dbus-daemon</em></em></a>”, documentação oficial do dbus-daemon</li><li>“<a href="https://dbus.freedesktop.org/doc/dbus-send.1.html" rel="noopener"><em><em>dbus-send</em></em></a>”, documentação oficial do dbus-send</li><li>“<a href="https://dbus.freedesktop.org/doc/dbus-monitor.1.html" rel="noopener"><em><em>dbus-monitor</em></em></a>”, documentação oficial do dbus-monitor</li></ul>

            </section>

        </article>
    </main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="https://radialle.com">Radialle</a> &copy; 2020</section>
        <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
    </footer>
</body>
</html>
