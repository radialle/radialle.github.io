<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[Radialle]]></title><description><![CDATA[Radialle]]></description><link>https://radialle.github.io/</link><image><url>https://radialle.github.io/favicon.png</url><title>Radialle</title><link>https://radialle.github.io/</link></image><generator>Ghost 3.12</generator><lastBuildDate>Tue, 07 Apr 2020 08:13:38 GMT</lastBuildDate><atom:link href="https://radialle.github.io/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[VÍDEO: Reproduzimos o ataque usado em celular de Sérgio Moro]]></title><description><![CDATA[Por meio das informações divulgadas, remontamos o incidente e demonstramos o uso da técnica para ativação do Telegram]]></description><link>https://radialle.github.io/video-reproduzimos-o-ataque-usado-em-celular-de-sergio-moro/</link><guid isPermaLink="false">5e893a675873f20001330115</guid><category><![CDATA[Análises]]></category><dc:creator><![CDATA[Rodrigo Laneth]]></dc:creator><pubDate>Thu, 25 Jul 2019 03:00:00 GMT</pubDate><media:content url="https://radialle.github.io/content/images/2020/04/0-4x7DmHwB0VuhwSwn.jpeg" medium="image"/><content:encoded><![CDATA[<img src="https://radialle.github.io/content/images/2020/04/0-4x7DmHwB0VuhwSwn.jpeg" alt="VÍDEO: Reproduzimos o ataque usado em celular de Sérgio Moro"><p><a href="http://agenciabrasil.ebc.com.br/ccj-da-camara-dos-deputados-ouve-o-ministro-sergio-moro-0" rel="noopener">Foto: Fabio Rodrigues Pozzebom/Agência Brasil</a></p><p><strong>5 de junho de 2019. </strong>“Um hacker invadiu o celular do ministro Sergio Moro (Justiça) nesta terça-feira (4)”, publica a <a href="http://archive.is/zCxC4" rel="noopener">Folha de S. Paulo</a>. “O celular teria sido hackeado por volta das 18h, segundo o Ministério da Justiça, quando Moro atendeu uma ligação feita pelo próprio número dele”, divulga o <a href="http://archive.is/B0AIO" rel="noopener">G1</a>.</p><p>Imediatamente após o ocorrido, profissionais e entusiastas de tecnologia da informação, incluindo desenvolvedores e pesquisadores de segurança, tentam interpretar as informações, muitas vezes distorcidas, que vêm a público. Um deles, Fabio Assolini, da Kaspersky, escreve uma <a href="http://archive.is/EYkua" rel="noopener"><em><em>thread</em></em></a><em><em> </em></em>no Twitter sobre os possíveis métodos usados para o ataque.</p><!--kg-card-begin: html--><blockquote class="twitter-tweet"><p lang="pt" dir="ltr">Sobre a invasão do celular do ministro <a href="https://twitter.com/SF_Moro?ref_src=twsrc%5Etfw">@SF_Moro</a>, algumas considerações sobre as 5 possíveis causas, discutidas nessa thread. Vai seguindo a linha :)</p>&mdash; Fabio Assolini (@assolini) <a href="https://twitter.com/assolini/status/1136708922935599104?ref_src=twsrc%5Etfw">June 6, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><!--kg-card-end: html--><p>Dentre as possibilidades, Assolini cita <a href="https://gizmodo.uol.com.br/sim-swap-tecnica-clona-whatsapp/" rel="noopener">SIM swap</a>, fraude que consiste em habilitar a linha do alvo em um cartão SIM do atacante por meio de engenharia social ou acesso privilegiado na operadora de telefonia. A mesma teoria foi levantada e defendida por inúmeros outros — e dentre eles, me incluo. Em 6 de junho, <a href="http://archive.is/EUNxY" rel="noopener">escrevi</a>: “<em><em>pelo que se sabe atualmente, não teve ‘celular hackeado’, e sim sequestro do número com participação de alguém da operadora</em></em>”.<br></p><p><strong><strong>23 de julho de 2019.</strong></strong> A Polícia Federal <a href="http://archive.is/kiLsg" rel="noopener">deflagra</a> a operação Spoofing, cumprindo sete mandados de busca e apreensão e quatro de prisão temporária contra suspeitos de envolvimento na “invasão do celular de Moro”. Já no dia 24, a íntegra da <a href="https://cdn.oantagonista.net/uploads/2019/07/DECISAO.pdf" rel="noopener">decisão</a> para prisão dos “supostos hackers” divulgada pelo O Antagonista nos fornece acesso às conclusões da investigação da PF.</p><blockquote><em><em>O Telegram permite que o usuário solicite o código de acesso via ligação telefônica com posterior envio de chamada de voz contendo o código para ativação do serviço Web, cuja mensagem fica gravada na caixa postal das vítimas. O invasor então realiza diversas ligações para o número alvo, a fim de que a linha fique ocupada, e a ligação contendo o código de ativação do serviço Telegram Web é direcionada para a caixa postal da vítima.</em></em></blockquote><p>Embora o documento não esclareça alguns pontos, as informações disponíveis nos permitem remontar com bom nível de confiança o ocorrido.</p><p>A esta altura, parece inquestionável que <strong><strong>não houve invasão ao celular de Moro.</strong></strong> Nenhum acesso indevido ao dispositivo utilizado pelo ex-magistrado, mas sim a utilização do número de sua linha telefônica para criação de uma conta no Telegram.</p><p>E é fato que o Telegram permite o envio do código de verificação para criação de uma nova conta ou login em uma conta já existente através de uma chamada de voz, e que esta pode ser encaminhada para a caixa postal do receptor se a linha encontrar-se ocupada ou se a ligação for manualmente rejeitada.</p><p>A peça perdida do quebra-cabeças é o que ocorre em seguida: <strong><strong>o meio utilizado pelo atacante para acessar a caixa postal do alvo.</strong></strong> Podemos deduzí-lo através da decisão judicial e do nome da operação Spoofing.</p><p>Para isso, deve-se saber que é possível efetuar ligações telefônicas falsificando a informação de origem, identificando a chamada como se houvesse partido de um número telefônico arbitrário. Esta técnica é conhecida como <a href="https://www.fcc.gov/consumers/guides/spoofing-and-caller-id" rel="noopener"><em><em>caller ID spoofing</em></em></a> e tem aplicações legítimas, mas obviamente também pode ser explorada para fins maliciosos.</p><p>De volta à decisão:</p><blockquote><em><em>A edição de números telefônicos pode ser realizada através de serviços de voz sobre IP (VOIP) ou por aplicativos que permitem a modificação do número chamador. (…) O cliente/usuário da BRVOZ utilizando a função ‘identificador de chamadas’ pode realizar ligações telefônicas simulando o número de qualquer terminal telefônico como origem das chamadas.</em></em></blockquote><p>Segundo o texto, o atacante utilizou o serviço de telefonia VoIP da <a href="http://www.brvoz.com.br/" rel="noopener">BRVOZ</a>. Após a divulgação das notícias, tentei contratar o serviço, mas tive o pagamento estornado e não consegui contato com os canais de atendimento. Presumidamente, a empresa encontra-se sobrecarregada devido à repentina atenção midiática.</p><p>No entanto, com uma breve pesquisa no Google, encontrei outra fornecedora que também possibilita o <em><em>caller ID spoofing</em></em>, a <a href="https://www.nvoip.com.br/" rel="noopener">Nvoip</a>. Desta vez, consegui criar uma conta.</p><p>Utilizei um número da operadora TIM para testes. Constatei que, ao efetuar uma chamada para ele com o “identificador de chamadas” da Nvoip configurado para o mesmo número, quando o celular encontra-se indisponível — seja por estar ocupado com outra ligação, fora de área ou por rejeição manual da chamada recebida — , o acesso à caixa postal torna-se possível.</p><p>Tal cenário encaixa-se perfeitamente com o que vem sendo divulgado desde junho, incluindo as ligações que Sérgio Moro relatou haver recebido do próprio número. Com a confiança de que esta é de fato a solução do mistério, reproduzi o ataque para gravar o vídeo de demonstração a seguir.</p><figure class="kg-card kg-embed-card"><iframe src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FILwIaHdueLM%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DILwIaHdueLM&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FILwIaHdueLM%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube" allowfullscreen frameborder="0" height="480" width="854" title="Reproduzimos o ataque usado em celular de Sérgio Moro" class="s t u hq ai" scrolling="auto" style="box-sizing: inherit; position: absolute; top: 0px; left: 0px; width: 680px; height: 382.1875px;"></iframe></figure><h2 id="como-se-proteger">Como se proteger</h2><p>A utilização da <strong><strong>autenticação de dois fatores (2FA)</strong></strong> é sempre recomendada: embora ela não possa impedir a criação de uma nova conta no Telegram, como ocorreu no caso de Moro, ela evitaria o acesso a uma conta já existente.</p><p>Fora do Telegram, é importante configurar suas contas para <strong><strong>utilizar formas mais robustas de 2FA</strong></strong> do que o recebimento de código por ligação, uma vez que estes estariam vulneráveis ao mesmo método. E, devido a outras possibilidades de ataque, o uso de SMS também não é recomendado. As alternativas incluem o uso de um aplicativo como o <a href="https://support.google.com/accounts/answer/1066447" rel="noopener">Google Authenticator</a>ou de um dispositivo de autenticação por hardware como o <a href="https://www.yubico.com/getstarted/meet-the-yubikey/" rel="noopener">YubiKey</a>.</p><p>No mais, deve-se <strong><strong>desativar o serviço de caixa postal</strong></strong> caso ele não seja utilizado. Consulte sua operadora em relação aos procedimentos para desativação.</p><p><strong><strong>Atualização (28/07/2019):</strong></strong> com a repercussão do caso de Moro, alterações têm sido realizadas para evitar ocorrências similares. Agora, no caso de contas já existentes, o Telegram <a href="https://twitter.com/telegram_br/status/1154868292982628353" rel="noopener">só permite o envio do código via ligação se a autenticação de dois fatores estiver ativada</a>, embora ainda seja possível solicitar a chamada para cadastro de um número de telefone no serviço. Também identificamos que as operadoras estão buscando corrigir a falha que permitia o acesso indevido à caixa postal. No entanto, para maior proteção dos usuários, inclusive contra outros tipos de ataque, <strong><strong>as recomendações feitas neste texto estão mantidas.</strong></strong></p><hr><p><em><em>Agradecimentos especiais a </em></em><strong><strong><em><em>Davidson Francis</em></em></strong></strong><em><em>, </em></em><strong><strong><em><em>Gustavo Oliveira</em></em></strong></strong><em><em> e </em></em><strong><strong><em><em>Shrimp</em></em></strong></strong><em><em>, integrantes da Radialle, que ajudaram na verificação dos fatos e na preparação deste conteúdo para publicação. As legendas do vídeo de demonstração foram produzidas por Davidson.</em></em></p>]]></content:encoded></item><item><title><![CDATA[Os mobiles já estão mais rápidos que os PCs?]]></title><description><![CDATA[A evolução do poder de processamento dos dispositivos móveis cresce a cada dia, mas será que eles já ultrapassam os computadores domésticos?]]></description><link>https://radialle.github.io/os-mobiles-ja-estao-mais-rapidos-que-os-pcs/</link><guid isPermaLink="false">5e89ab792dab310001ec9113</guid><category><![CDATA[Análises]]></category><dc:creator><![CDATA[Davidson Francis]]></dc:creator><pubDate>Sun, 07 Apr 2019 03:00:00 GMT</pubDate><media:content url="https://radialle.github.io/content/images/2020/04/1-kl8Vpj5-QUrzAVbzvSih3Q.jpeg" medium="image"/><content:encoded><![CDATA[<img src="https://radialle.github.io/content/images/2020/04/1-kl8Vpj5-QUrzAVbzvSih3Q.jpeg" alt="Os mobiles já estão mais rápidos que os PCs?"><p>Atualmente, a demanda por dispositivos de alto desempenho está cada vez maior, e, aliado a isso, há também um grande foco em reduzir cada vez mais o consumo de energia e temperatura. Com isso, tornou-se possível o desenvolvimento de pequenos ‘monstrinhos’, como o <a href="https://www.parallella.org/" rel="noopener">Parallella</a> e o <a href="https://nvidianews.nvidia.com/news/nvidia-announces-jetson-nano-99-tiny-yet-mighty-nvidia-cuda-x-ai-computer-that-runs-all-ai-models" rel="noopener">Jetson Nano</a>, que, embora de baixo custo, conseguem competir facilmente com Desktops tradicionais.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-20.png" class="kg-image" alt="Os mobiles já estão mais rápidos que os PCs?"><figcaption>Parallella (99$) à esquerda e Jetson Nano (também a 99$) à direita, ambos consomem apenas 5 W.</figcaption></figure><p>Com os smartphones e tablets não é diferente, dificilmente alguém em 2005 afirmaria que em 2019 teríamos dispositivos com 4 GB de RAM, 64 GB de memória interna e 8 núcleos de CPU, e aqui estamos.</p><p>Mas a pergunta inicial continua: um celular atual consegue se equiparar a uma CPU atual? Vamos aos testes.</p><h1 id="metodologia">Metodologia</h1><p>Foi decidido utilizar o algoritmo clássico de multiplicação de matrizes, uma vez que é um algoritmo sem dependência de dados e que escala bem à medida que se aumenta o número núcleos.</p><p>O presente artigo não tem a intenção de descrever como foi preparado o ambiente no hardware utilizado, nem de descrever os algoritmos, uma vez que estes são facilmente encontrados na internet.</p><h2 id="hardware-utilizado-">Hardware utilizado:</h2><p><strong><strong><em><em>Mobile</em></em></strong></strong>: LG K11+:</p><ul><li>MediaTek MT6750 com: 1 cluster ARM-Cortex A53 @ 1.5GHz + 1 cluster Cortex-A53 @ 1.0GHz</li><li>Mali T860 MP2: 2 clusters a 700 MHz c/ 16 shader cores.</li></ul><p><strong><strong><em><em>Desktop</em></em>:</strong></strong> Intel Core i7 2600 @ 3.4GHz, 4 cores com Hyper-Threading.</p><h2 id="software-utilizado-">Software utilizado:</h2><p><strong><strong><em><em>Mobile:</em></em></strong></strong> clang 7.0.1 e NDK r19c.</p><p><strong><strong><em><em>Desktop</em></em></strong></strong>: gcc 5.3.0</p><p>*Importante observar que nenhuma flag de otimização foi utilizada durante a compilação dos testes.</p><h1 id="resultados">Resultados</h1><p>Os testes a seguir foram todos executados com matrizes de tamanho 512x512, com o MediaTek MT6750 a utilizar todos os cores disponíveis e o Core i7 com 1 e 4 cores. Para os testes de CPU, foi utilizado o OpenMP e de GPU o OpenCL 1.2.</p><p>Os tempos foram aferidos utilizando a rotina <em><em>omp_get_wtime()</em></em> (código para CPU, em OpenMP) e o <em><em>profilling</em></em> que o próprio OpenCL fornece (para as versões em GPU). Estão em segundos e para cada teste foi executado 10 vezes e obtido a média.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-21.png" class="kg-image" alt="Os mobiles já estão mais rápidos que os PCs?"><figcaption>Figura 1a: MT6750 vs i7 2600</figcaption></figure><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-22.png" class="kg-image" alt="Os mobiles já estão mais rápidos que os PCs?"><figcaption>Figura 1b: MT6750 vs i7 2600, Single vs Multicore</figcaption></figure><p>Nas Figura 1a e 1b, fica claro a diferença entre as CPUs, mesmo que contra apenas um único core do i7 2600. Na Figura 2, é apresentado o Speedup, onde pode-se perceber facilmente que o Core i7 foi cerca de 18x mais rápido, quando utilizado apenas 1 core, e cerca de 48x mais rápido quando utilizado todos os seus 4 cores.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-23.png" class="kg-image" alt="Os mobiles já estão mais rápidos que os PCs?"><figcaption>Figura 2: Speedup MT6750 e i7 2600</figcaption></figure><p>Isso significa que os celulares estão muito longe dos desktops? não exatamente, ainda nos resta a GPU.</p><p>É de conhecimento geral que uma GPU facilmente supera uma CPU para certos tipos de aplicação, portanto, antes de prosseguir com os testes, vamos ver o quanto a Mali T860MP2 consegue ser superior que o MediaTek MT6750:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-24.png" class="kg-image" alt="Os mobiles já estão mais rápidos que os PCs?"><figcaption>Figura 3: Speedup MT6750 e Mali T860 MP2</figcaption></figure><p>Na Figura 3 a Mali chega a ser 117x superior ao MediaTek em Single Core!, e cerca de 40x no Multi Core, portanto, os testes a seguir irão utilizar a GPU como referência.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-25.png" class="kg-image" alt="Os mobiles já estão mais rápidos que os PCs?"><figcaption>Figura 4: GPU vs CPU</figcaption></figure><p>Pode-se observar uma grata surpresa na figura acima: para um único core do i7 2600, a GPU conseguiu um tempo de execução <em><em>menor</em></em> que o da CPU, e, para todos os 4 cores do i7, o Desktop se saiu levemente na frente comparado a GPU.</p><p>O que nos leva aos seguintes resultados finais:</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-26.png" class="kg-image" alt="Os mobiles já estão mais rápidos que os PCs?"><figcaption>Figura 5: Speedup GPU e CPU</figcaption></figure><p>A Mali foi cerca de 113% superior ao i7 quando utilizado apenas um único core! e cerca de 21% mais lento quando o Desktop utilizou todos os cores.</p><h1 id="conclus-o">Conclusão</h1><p>É importante ressaltar que apenas um único teste utilizando um <em><em>kernel</em></em>simples como esse não pode ser encarado como a palavra final para o assunto em questão. Existe a possibilidade de otimizar o benchmark para beneficiar de todos os recursos que tanto a GPU quanto a CPU fornecem, bem como testar outros tipos de cargas de trabalho, com outros tamanhos e etc.</p><p>Contudo, é válido notar que, embora uma CPU mid/low-end como o MediaTek MT6750 tenha ficado muito atrás do desktop (no teste CPU vs CPU), a GPU do mesmo SoC conseguiu se aproximar bastante e pode-se dizer que possui desempenho equiparável para certos tipos de aplicação, como no processamento de imagens por exemplo.</p><p>Também é válido acrescentar que muitos <em><em>apps</em></em> não utilizam de todos os cores e muito menos da GPU que o dispositivo possui, restringindo a apenas um único core, o que passa muito longe do desempenho de um desktop (vide Figuras 1a e 1b).</p><p>De toda forma, é esperado que os resultados sejam bem diferentes ao comparar dispositivos <em><em>high-end</em></em> como o Snapdragon 855/Adreno 640. Será que o futuro da computação será dominado por dispositivos ARM? talvez RISC-V? ou a Intel/AMD pensará em um jeito de reverter a situação?</p><p>Cenas dos próximos capítulos…</p>]]></content:encoded></item><item><title><![CDATA[Criando um fork do Telegram para Android]]></title><description><![CDATA[Da clonagem do respositório à compilação]]></description><link>https://radialle.github.io/criando-um-fork-do-telegram-para-android/</link><guid isPermaLink="false">5e8939305873f200013300ff</guid><category><![CDATA[Software]]></category><dc:creator><![CDATA[Rodrigo Laneth]]></dc:creator><pubDate>Fri, 21 Dec 2018 03:00:00 GMT</pubDate><media:content url="https://radialle.github.io/content/images/2020/04/1-FS_fV4cMzpm2NxjL0GnF5g.jpeg" medium="image"/><content:encoded><![CDATA[<img src="https://radialle.github.io/content/images/2020/04/1-FS_fV4cMzpm2NxjL0GnF5g.jpeg" alt="Criando um fork do Telegram para Android"><p><a href="https://unsplash.com/photos/2c9ffiPlD9Q" rel="noopener">Foto: NeONBRAND/Unsplash</a></p><p>O <strong><strong>Telegram</strong></strong>, um dos serviços de mensagens instantâneas mais populares da atualidade, se destaca pela <a href="https://telegram.org/apps" rel="noopener">abertura do código-fonte</a>, de <a href="https://core.telegram.org/api" rel="noopener">suas APIs</a> e pela existência de uma <a href="https://telegram.org/blog/tdlib" rel="noopener">biblioteca oficial para a construção de clientes alternativos</a>, características que atraem os usuários com conhecimento avançado e o tornam um dos comunicadores mais <em><em>developer-friendly</em> </em>disponíveis no mercado.</p><p>É fato que ele possui defeitos. Condenações ao <a href="https://news.ycombinator.com/item?id=16746148" rel="noopener">uso de criptografia ponta-a-ponta somente em <em><em>secret chats</em></em></a>, <a href="https://crypto.stackexchange.com/questions/55108/has-telegram-security-been-significantly-improved-with-mtproto-2-0" rel="noopener">questionamentos em relação à segurança do MTProto</a> e a <a href="https://www.reddit.com/r/Telegram/comments/4b45ie/when_if_ever_will_telegrams_server_side_source/" rel="noopener">não divulgação do código-fonte dos servidores</a> são algumas das polêmicas que ele enfrentou ao longo de sua existência. Umas das críticas mais relevantes é a do renomado especialista em segurança <a href="https://twitter.com/thegrugq" rel="noopener">The Grugq</a>, que, em seu texto “<a href="https://medium.com/@thegrugq/operational-telegram-cbbaadb9013a" rel="noopener"><em><em>Operational Telegram</em></em></a>”, de novembro de 2015, conclui:</p><blockquote><em><em>O Telegram é suscetível a erros, utiliza criptografia questionável, vaza um grande volume de informações, rouba os contatos do dispositivo, e agora é conhecido como ponto de encontro para terroristas.</em></em></blockquote><p>Mas apesar das controvérsias, o Telegram permanece popular e, por isso, é um interessante objeto de estudo. Então, decidi recentemente iniciar um <em><em>fork</em></em> para aprender com o código-fonte dos clientes oficiais.</p><h2 id="iniciando">Iniciando</h2><p>Antes de decidir qual aplicação do Telegram usaria como base para o desenvolvimento, a minha única preferência era pelas versões <em><em>mobile</em></em>. Mesmo assim, tive algumas frustrações devido à inconsistência na manutenção e na divulgação do código-fonte dos clientes.</p><p>Em janeiro de 2018, o Telegram <a href="https://telegram.org/blog/telegram-x" rel="noopener">anunciou um novo cliente oficial</a> para Android e iOS, o <strong><strong>Telegram X</strong></strong>, que seria mantido paralelamente à alternativa clássica nas lojas de aplicativos das respectivas plataformas. Meses depois, em setembro, anunciou-se a <a href="https://techcrunch.com/2018/09/19/telegram-to-replace-ios-messaging-app-with-telegram-x-swift-rebuild/" rel="noopener">substituição da versão clássica pela X no iOS</a> — muito embora, no momento da publicação deste texto, o app chamado <a href="https://itunes.apple.com/us/app/telegram-x/id898228810" rel="noopener">Telegram X permaneça disponível na App Store</a> ao lado do <a href="https://itunes.apple.com/us/app/telegram-messenger/id686449807" rel="noopener">Telegram Messenger</a>.</p><p>Há pouco tempo atrás, o código-fonte referenciado no site oficial <a href="https://github.com/peter-iakovlev/Telegram" rel="noopener">estava bastante defasado</a>. Hoje, ele aponta para um <a href="https://github.com/peter-iakovlev/Telegram-iOS" rel="noopener">novo repositório no GitHub</a>, aparentemente contendo uma versão mais atual — que <strong><strong>pode</strong></strong> ser baseado no Telegram X. Já o código-fonte do Telegram X para Android aparentemente nunca foi publicado.</p><p>No caso do <a href="https://play.google.com/store/apps/details?id=org.telegram.messenger" rel="noopener">Telegram clássico para Android</a>, a situação é menos confusa, com o código-fonte <a href="https://github.com/DrKLO/Telegram" rel="noopener">encontrado no GitHub</a> aparentando equivaler ao aplicativo na Play Store. Enfim, optei por utilizá-lo para o desenvolvimento do <em><em>fork</em></em>.</p><h2 id="configura-o-do-ambiente">Configuração do ambiente</h2><p>As instruções a seguir descrevem a configuração de um ambiente baseado no <strong><strong>Fedora 29</strong></strong> para compilação do Telegram para Android conforme presente em seu repositório do GitHub durante a elaboração deste texto (no momento em que escrevo, o <em><em>commit</em></em> mais recente é o <a href="https://github.com/DrKLO/Telegram/commit/e222fded6cca5ace3649be6f18b55f526311bc79" rel="noopener">e222fde</a>, de 7 de novembro de 2018).</p><p>Embora baseadas no Fedora, as instruções podem ser interpretadas sem grandes dificuldades para aplicação em outras distribuições Linux ou mesmo em sistemas operacionais completamente distintos.</p><p>Como a intenção desta seção é orientar sobre a compilação do aplicativo em sua forma original, evitando alterações ao projeto publicado, precisei basear-me em versões antigas de algumas ferramentas requeridas. São elas:</p><ul><li><strong><strong>Android NDK</strong></strong> (atual: r18b; utilizada: r16b);</li><li><strong><strong>Gradle</strong></strong> (atual: 4.6; utilizada: 4.4);</li><li><strong><strong>Plugin Android Gradle</strong></strong> (atual: 3.2.1; utilizada: 3.1.4)</li></ul><p>Os problemas encontrados em relação às versões mais recentes de cada um dos itens listados estão descritos na próxima seção deste texto.</p><ol><li><strong><strong>Instalação do Android Studio</strong></strong><br>Basta efetuar o <a href="https://developer.android.com/studio/install#linux" rel="noopener">download</a> e prosseguir com a instalação de acordo com as <a href="https://developer.android.com/studio/install#linux" rel="noopener">instruções oficiais</a>, que se resumem a extrair o arquivo <code>.zip</code> para o local desejado e executar o script <code>studio.sh</code> na pasta <code>android-studio/bin</code> .</li><li><strong><strong>Instalação do Android NDK r16b</strong></strong><br>O <a href="https://developer.android.com/ndk/" rel="noopener">NDK (<em><em>Native Development Kit</em></em>)</a> é um conjunto de ferramentas para implementação de partes de um aplicativo Android em código nativo, por meio de linguagens como C e C++. É necessário para compilar bibliotecas incluídas no projeto do Telegram.</li><li><strong><strong>Clonagem do repositório do Telegram para Android</strong></strong><br>Exemplo para linha de comando:<strong><strong> </strong></strong><code>git clone --recurse-submodules <a href="https://github.com/DrKLO/Telegram.git" rel="noopener">https://github.com/DrKLO/Telegram.git</a></code> . Destaque para o parâmetro <code>--recurse-submodules</code>, necessário para que o download do código da biblioteca <a href="https://github.com/DrKLO/Telegram/blob/6a1cf64f6f45ba0d0e7ff898e8a6c677ddc3ef33/.gitmodules" rel="noopener">libgtvoip</a>, incluída no repositório como <a href="https://blog.github.com/2016-02-01-working-with-submodules/" rel="noopener">submódulo</a>, seja também realizado no processo.</li><li><strong><strong>Configuração do Android Studio</strong></strong><br>Após abrir o projeto do Telegram para Android, é preciso configurar o caminho para o Android NDK através da janela <em><em>Project Structure</em></em>, que pode ser acessada por meio do menu <em><em>File</em></em>.</li><li><strong><strong>Modificação do </strong></strong><a href="https://github.com/DrKLO/Telegram/blob/e222fded6cca5ace3649be6f18b55f526311bc79/TMessagesProj/src/main/java/org/telegram/messenger/BuildVars.java" rel="noopener"><strong><strong>BuildVars.java</strong></strong></a><br>É necessário gerar e adicionar ao arquivo as suas próprias chaves de API para o <a href="https://core.telegram.org/api/obtaining_api_id" rel="noopener">Telegram</a> e <a href="https://www.hockeyapp.net/" rel="noopener">HockeyApp</a>, conforme <a href="https://github.com/DrKLO/Telegram/blob/d073b80063c568f31d81cc88c927b47c01a1dbf4/README.md" rel="noopener">avisado no README</a> do repositório. Também é interessante observar as outras variáveis presentes e modificá-las conforme desejado.</li><li><strong><strong>Adição do </strong></strong><a href="https://developers.google.com/android/guides/google-services-plugin" rel="noopener"><strong><strong>google-services.json</strong></strong></a><br>O <code>google-services.json</code> é um arquivo de configuração necessário para habilitar o uso de APIs da Google utilizadas pelo Telegram. O processo de geração e adição do arquivo a um projeto do Android Studio é <a href="https://support.google.com/firebase/answer/7015592" rel="noopener">descrito na página de suporte</a> da Google.</li><li><strong><strong>Gerar chave para assinatura</strong></strong><br>Por fim, é necessário gerar chaves para assinar o aplicativo. Uma maneira de fazê-lo de dentro do próprio Android Studio é através da opção <em><em>Build &gt; Generate Signed Bundle / APK… &gt; APK </em></em>(selecionar) <em><em>&gt; Next &gt; Create new…</em></em>. Alternativamente, a ferramenta <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html" rel="noopener">keytool</a> do Java pode ser usada. A <em><em>keystore</em></em> deve ser salva no diretório <code>TMessagesProj/config</code> com o nome <em><em>release.keystore</em></em>, e o <em><em>alias</em></em> da chave gerada, bem como a senha da <em><em>keystore</em></em> e a senha da chave, devem ser adicionadas nas propriedades do projeto (arquivo <em><em>gradle.properties</em></em>).</li></ol><h2 id="problemas-com-vers-es-recentes-das-ferramentas-utilizadas">Problemas com versões recentes das ferramentas utilizadas</h2><p>No momento em que escrevo, existem duas versões estáveis mais recentes do Android NDK disponíveis: a r17c e a r18b.</p><p>O projeto do Telegram para Android tem como requerimento mínimo a API nível 16, associada ao Android 4.1 Jelly Bean. No entanto, bibliotecas usadas por ele utilizam a função <code>posix_memalign</code>, que, a partir do NDK r17c, passou a estar disponível somente para os níveis de API superiores à 17, do Android 4.2 Jelly Bean MR1.</p><p>A justificativa para a mudança, de acordo com <a href="https://github.com/android-ndk/ndk/issues/647" rel="noopener">este issue no repositório do NDK no GitHub</a>, é que a <code>posix_memalign</code> não havia sido implementada em alguns dispositivos com o Android 4.1 Jelly Bean.</p><p>Por sua vez, o NDK r18b abandonou o suporte ao compilador GCC e agora força o uso do Clang, que não compila as bibliotecas do projeto.</p><p>É possível utilizar o NDK r17c alterando o requerimento mínimo do projeto para a API nível 17. O uso do NDK r18, no entanto, exigiria maiores alterações. Há um <a href="https://github.com/DrKLO/Telegram/pull/1483" rel="noopener">pull request aberto</a>, não avaliado nem testado por mim, que promete aplicar as mudanças apropriadas.</p><p>Em relação ao Gradle, a versão 4.6 provoca conflito com a opção depreciada <code>android.enableD8</code>, que desativa o <a href="https://android-developers.googleblog.com/2017/08/next-generation-dex-compiler-now-in.html" rel="noopener">D8</a> e está <a href="https://github.com/DrKLO/Telegram/blob/e222fded6cca5ace3649be6f18b55f526311bc79/gradle.properties#L20" rel="noopener">presente no arquivo <em><em>gradle.properties</em></em></a>, e o <a href="https://android-developers.googleblog.com/2017/04/java-8-language-features-support-update.html" rel="noopener"><em><em>desugaring</em></em></a>, uma etapa extra de otimização do bytecode que tornou-se padrão. Ocorrem problemas também com o valor da <code>buildToolsVersion</code> <a href="https://github.com/DrKLO/Telegram/blob/e222fded6cca5ace3649be6f18b55f526311bc79/TMessagesProj/build.gradle#L36" rel="noopener">declarado no arquivo <em><em>build.gradle</em></em> do TMessagesProj</a>.</p><p>Possíveis soluções são desativar o <em><em>desugaring</em></em> adicionando <code>android.enableD8.desugaring=false</code> ao <em><em>build.gradle</em></em> e elevar o valor da <code>buildToolsVersion</code> de <code>28.0.2</code> para <code>28.0.3</code>.</p><p>No mais, cabe mencionar que o <em><em>plugin</em></em> Android Gradle não pode ser atualizado para a versão 3.1.4 sem que o Gradle seja também atualizado para a 4.6.</p><h2 id="conclus-o">Conclusão</h2><p>Uma vez que o aplicativo tenha sido corretamente compilado, começa-se a pensar na aplicação das modificações desejadas. Particularmente, penso que atualizar o projeto para funcionar com versões mais recentes do Android NDK e do Gradle seriam excelentes primeiros passos.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-19.png" class="kg-image" alt="Criando um fork do Telegram para Android"><figcaption>Telegram com <strong><strong>AlertDialog</strong></strong> adicionado à <a href="https://github.com/DrKLO/Telegram/blob/e222fded6cca5ace3649be6f18b55f526311bc79/TMessagesProj/src/main/java/org/telegram/ui/IntroActivity.java" rel="noopener"><strong><strong>IntroActivity</strong></strong></a></figcaption></figure><p>Por fim, destaco o <a href="https://github.com/Telegram-FOSS-Team/Telegram-FOSS" rel="noopener">Telegram FOSS</a>. Trata-se de um <em><em>fork</em></em> não oficial do Telegram para Android cuja principal promessa é substituir ou remover elementos “não-<a href="https://en.wikipedia.org/wiki/Free_and_open-source_software" rel="noopener">FOSS</a>, pouco confiáveis ou suspeitos” do mensageiro. Dentre as modificações efetuadas, estão a troca do Google Cloud Messaging pelo serviço de <em><em>push</em></em> do Telegram e a remoção do HockeyApp.</p><p>Não somente esta versão pode ser um melhor ponto de partida para a criação de um <em><em>fork</em></em> do Telegram — a depender, é claro, de suas preferências e objetivos — , o trabalho já realizado pelos seus desenvolvedores podem servir de auxílio mesmo para quem preferir basear-se na versão oficial.</p>]]></content:encoded></item><item><title><![CDATA[Slack como sistema de notificações]]></title><description><![CDATA[Popular ferramenta de colaboração é útil para gerenciar avisos]]></description><link>https://radialle.github.io/slack-como-sistema-de-notificacoes/</link><guid isPermaLink="false">5e89375f5873f200013300e0</guid><category><![CDATA[Software]]></category><dc:creator><![CDATA[Rodrigo Laneth]]></dc:creator><pubDate>Fri, 19 Oct 2018 03:00:00 GMT</pubDate><media:content url="https://radialle.github.io/content/images/2020/04/1-fJJwanZUQS644-LV54J1pw.png" medium="image"/><content:encoded><![CDATA[<img src="https://radialle.github.io/content/images/2020/04/1-fJJwanZUQS644-LV54J1pw.png" alt="Slack como sistema de notificações"><p><a href="https://unsplash.com/photos/bmmcfZqSjBU" rel="noopener">Imagem: Scott Web/Unsplash</a></p><p>Há alguns dias, precisei de uma solução para notificações que atendesse a alguns requisitos específicos: as mensagens poderiam ser originadas de um ou mais sistemas, devendo ser separadas em categorias e entregues aos aparelhos Android e iOS dos usuários autorizados.</p><p>Como nem todos os usuários teriam autorização para receber todas as notificações, também era extremamente importante poder restringir a quem elas seriam entregues com base na categoria em que se enquadrassem.</p><p>Considerei diversas possibilidades, incluindo a de desenvolver um sistema próprio, mas os custos seriam elevados: a implementação de <em><em>push notifications</em></em> em um app para iOS, por exemplo, requer participação no <a href="https://developer.apple.com/programs/" rel="noopener">Apple Developer Program</a>, a uma taxa de US$99/ano — preço pouco atrativo quando o objetivo é simplesmente permitir que algumas pessoas recebam notificações.</p><p>Por fim, optei por utilizar o <a href="https://slack.com/" rel="noopener">Slack</a>, uma conhecida ferramenta de comunicação para equipes. Embora possa não parecer uma escolha óbvia a princípio, notei que era a maneira mais eficiente de resolver a questão.</p><h1 id="slack">Slack</h1><p>Para compreender como a plataforma atende aos requisitos apresentados, é preciso conhecer o básico sobre o seu funcionamento, especialmente no que diz respeito aos <a href="https://get.slack.help/hc/en-us/articles/212675257-Join-a-Slack-workspace" rel="noopener"><em><em>workspaces</em></em></a> e suas subdivisões, os canais.</p><p>Cada <em><em>workspace</em></em> é um espaço onde um grupo de pessoas — que podem ser, por exemplo, os funcionários de uma empresa, os estudantes de uma universidade ou os membros de um <em><em>makerspace</em></em> — se comunica, e o seu acesso é restrito de acordo com as configurações e convites enviados pelos administradores.</p><p>Além disso, cada canal em um <em><em>workspace</em></em> pode ser aberto a todos os membros do espaço, ou apenas para convidados.</p><p>O Slack conta com <a href="https://slack.com/download" rel="noopener">apps</a> para as mais diversas plataformas, incluindo <a href="https://slack.com/downloads/android" rel="noopener">Android</a> e <a href="https://slack.com/downloads/ios" rel="noopener">iOS</a>. Por meio deles, os usuários podem ser notificados quando mensagens são enviadas aos canais dos quais eles participam.</p><p>Também é possível alterar configurações de notificação de acordo com o canal — de maneira que um usuário pode, por exemplo, silenciar as notificações de mensagens do canal #a, mas continuar recebendo as do #b.</p><h2 id="api">API</h2><p>A API do Slack permite a publicação nos diversos canais de um <em><em>workspace</em></em>, de forma que as notificações de um sistema A podem ser enviadas ao canal #a, e as de um sistema B, ao canal #b. Desta forma, satisfazem-se as necessidades de separação em categorias e controle de acesso.</p><p>O recurso que permite a publicação de mensagens por meio da API é chamado de <a href="https://api.slack.com/incoming-webhooks" rel="noopener"><em><em>Incoming Webhooks</em></em></a>, e os passos para utilizá-lo são, em resumo, criar um <a href="https://api.slack.com/docs/slack-button#register_your_slack_app" rel="noopener">Slack app</a>, <a href="https://api.slack.com/apps" rel="noopener">ativar a função</a> e, em seguida, as URLs através das quais as publicações serão feitas.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-18.png" class="kg-image" alt="Slack como sistema de notificações"><figcaption>Autorizando a publicação via Incoming Webhooks no canal <strong><strong>#general</strong></strong></figcaption></figure><p>O uso dos <em><em>Incoming Webhooks</em></em> é extremamente simples, bastando o envio de uma solicitação POST às URLs geradas. Assim, é possível inclusive efetuar publicações através da ferramenta de linha de comando <a href="https://curl.haxx.se/" rel="noopener">curl</a>, conforme exemplificado a seguir.</p><!--kg-card-begin: markdown--><pre><code>curl -X POST -H 'Content-type: application/json' --data '{&quot;text&quot;:&quot;Hello, World!&quot;}' &lt;Webhook URL criada pelo Slack aqui&gt;
</code></pre>
<!--kg-card-end: markdown--><h2 id="custos">Custos</h2><p>O Slack <a href="https://slack.com/pricing" rel="noopener">oferece um plano gratuito</a> que, embora com limitações — como a restrição de visualização além das últimas 10 mil mensagens enviadas ao espaço — , provou atender perfeitamente ao meu caso de uso. Além disso, não há necessidade de investir na manutenção de servidores da aplicação, uma vez que se trata de solução hospedada.</p><h1 id="alternativa-mattermost">Alternativa: Mattermost</h1><p>Quando comentei em um pequeno canal privado do Telegram sobre o uso do Slack para notificações, fui lembrado da existência do <a href="https://mattermost.com/" rel="noopener">Mattermost</a>. Menciono-o aqui pois pode ser uma opção mais adequada para casos de uso distintos, ainda que similares ao descrito.</p><p>O Mattermost é uma alternativa ao Slack que pode ser obtida e instalada pelo usuário em servidor próprio. Funciona, portanto, como um produto, e não como um serviço hospedado. Há uma versão gratuita e open source, licenciada sob os termos da licença MIT.</p><p>Tal como o Slack, o Mattermost suporta <a href="https://docs.mattermost.com/developer/webhooks-incoming.html" rel="noopener"><em><em>Incoming Webhooks</em></em></a>, sendo assim uma outra opção viável para uso como sistema de notificações.</p><h1 id="conclus-o">Conclusão</h1><p>O Slack, embora apresentado como ferramenta de comunicação para equipes, funciona também como uma excelente plataforma para entrega e gestão de notificações, oferecida a um custo bastante reduzido — e muitas vezes gratuita.</p><p>Conhecer esta possibilidade de utilização do serviço pode ser particularmente interessante para pessoas e pequenos grupos que se identificam com a <a href="https://epocanegocios.globo.com/colunas/noticia/2018/04/um-guia-para-se-relacionar-com-cultura-maker.html" rel="noopener">cultura <em><em>maker</em></em></a> e desenvolvem projetos envolvendo o envio de notificações para aparelhos como smartphones e tablets.</p><p>Há ainda o Mattermost, alternativa ao Slack, que, apesar de requerer hospedagem e manutenção, a depender do caso de uso, pode representar uma melhor opção.</p>]]></content:encoded></item><item><title><![CDATA[CVE-2018-5258 Writeup: aplicativo do banco Neon para iOS não valida certificados SSL]]></title><description><![CDATA[A vulnerabilidade havia sido confirmada na versão mais recente do aplicativo (1.6.14); correção foi disponibilizada na quarta-feira (17)]]></description><link>https://radialle.github.io/cve-2018-5258-writeup-aplicativo-do-banco-neon-para-ios-nao-valida-certificados-ssl/</link><guid isPermaLink="false">5e89355c5873f200013300b3</guid><category><![CDATA[Segurança]]></category><dc:creator><![CDATA[Rodrigo Laneth]]></dc:creator><pubDate>Mon, 15 Jan 2018 03:00:00 GMT</pubDate><media:content url="https://radialle.github.io/content/images/2020/04/cover.png" medium="image"/><content:encoded><![CDATA[<img src="https://radialle.github.io/content/images/2020/04/cover.png" alt="CVE-2018-5258 Writeup: aplicativo do banco Neon para iOS não valida certificados SSL"><p><strong><strong>Atualização (17/01/2018):</strong></strong> foi <a href="https://itunes.apple.com/br/app/neon/id1127996388" rel="noopener">disponibilizada hoje na App Store</a> a versão 1.6.15 do aplicativo, que corrige a falha. O conteúdo original deste texto, a seguir, foi mantido.</p><hr><p>Enquanto realizava alguns testes com aplicativos mobile no mês passado, me chamou a atenção o fato de que eu estava conseguindo interceptar, com o <a href="https://portswigger.net/burp" rel="noopener">Burp Proxy</a>, tráfego HTTPS associado ao <a href="https://itunes.apple.com/br/app/neon/id1127996388" rel="noopener">aplicativo do banco Neon</a>, muito embora o certificado SSL gerado pela ferramenta não estivesse instalado no meu dispositivo.</p><p>Este tipo de vulnerabilidade é identificado pelo projeto CWE (<em><em>Common Weakness Enumeration</em></em>) como <a href="https://cwe.mitre.org/data/definitions/295.html" rel="noopener">CWE-295: Improper Certificate Validation</a>.</p><p>Uma particularidade do Neon é que ele implementa, além da SSL, uma camada própria de criptografia, a qual precisei estudar para avaliar o risco representado pela falha. Encontrei fraquezas e confirmei que esta proteção adicional não impede a exploração da vulnerabilidade.</p><p>Elaborei um <em><em>advisory</em></em> e o enviei para a <a href="http://seclists.org/fulldisclosure/" rel="noopener">Full Disclosure</a>. Publiquei também no <a href="https://gist.github.com/rlaneth/d2203c206d5d5acbdaf6069e78b1d07f" rel="noopener">Gist</a> para que ele pudesse ser acessado antes de ser aprovado na lista, e o incluí no final deste texto.</p><h2 id="detalhes">Detalhes</h2><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-16.png" class="kg-image" alt="CVE-2018-5258 Writeup: aplicativo do banco Neon para iOS não valida certificados SSL"><figcaption>Interceptando requisições do Neon com o Burp Proxy</figcaption></figure><p>O aplicativo não verifica os certificados SSL dos domínios <strong><strong>webapimethods.banconeon.com.br</strong></strong> e <strong><strong>servicos.banconeon.com.br</strong></strong>, permitindo que um atacante intercepte as requisições silenciosamente via <a href="https://www.kaspersky.com/blog/man-in-the-middle-attack/1613/" rel="noopener">man-in-the-middle</a>.</p><p>Um dos grandes problemas com o esquema de criptografia próprio do Neon é o uso de uma chave AES enviada pelo servidor ao cliente no momento em que o usuário efetua o login para criptografar dados sensíveis que são enviados e recebidos nas requisições. Ocorre que, apesar desta chave estar criptografada com RSA no momento da transmissão, as chaves privadas necessárias para descriptografá-la são fixas e estão presentes no código do aplicativo, de onde poderiam ser facilmente extraídas por um atacante por meio de técnicas de engenharia reversa.</p><p>Durante os testes, uma possibilidade que chamou a atenção foi a de interceptar o nome do usuário, número completo, data de registro, validade e CVV do cartão virtual na requisição ao <em><em>endpoint</em></em> <strong><strong>//v1/Card/GetCards</strong></strong>.</p><p>A seguir, incluo um exemplo de JSON enviado como resposta por este <em><em>endpoint</em></em>, já descriptografado com a chave capturada durante o login. Para fins de publicação, substituí os dados sensíveis pelas sequências de “x” em negrito. É importante destacar que o número do cartão virtual aparece completo, junto com todas as outras informações que um atacante necessitaria para utilizá-lo.</p><!--kg-card-begin: markdown--><pre><code>{
   &quot;Success&quot;:true,
   &quot;Message&quot;:{
      &quot;Title&quot;:&quot;Atenção&quot;,
      &quot;Message&quot;:&quot;Sucesso!&quot;,
      &quot;MessageId&quot;:0
   },
   &quot;Data&quot;:{
      &quot;HasPassword&quot;:true,
      &quot;Cards&quot;:[
         {
            &quot;EmbossingName&quot;:&quot;xxxxxxxxxxxxxxx&quot;,
            &quot;CardStatusApp&quot;:5,
            &quot;CardType&quot;:2,
            &quot;IdCardConductor&quot;:xxxxxx,
            &quot;Id&quot;:xxxxxx,
            &quot;CardNumber&quot;:&quot;xxxx xxxx xxxx xxxx&quot;,
            &quot;RegisterDate&quot;:&quot;xx/xx/xxxx&quot;,
            &quot;ValidThru&quot;:&quot;xx/xx&quot;,
            &quot;CVV&quot;:&quot;xxx&quot;
         },
         {
            &quot;EmbossingName&quot;:&quot;xxxxxxxxxxxxxxx&quot;,
            &quot;CardStatusApp&quot;:5,
            &quot;CardType&quot;:1,
            &quot;IdCardConductor&quot;:xxxxxx,
            &quot;Id&quot;:xxxxxx,
            &quot;CardNumber&quot;:&quot;xxxx&quot;,
            &quot;RegisterDate&quot;:&quot;xx/xx/xxxx&quot;,
            &quot;ValidThru&quot;:&quot;xx/xx&quot;,
            &quot;CVV&quot;:null
         }
      ],
      &quot;HasMultipleCard&quot;:true
   }
}
</code></pre>
<!--kg-card-end: markdown--><h2 id="notifica-o">Notificação</h2><p>Após confirmar que um atacante poderia usar a falha para obter dados sensíveis dos usuários do aplicativo, notifiquei o banco. Meu e-mail, enviado para <a href="mailto:oi@banconeon.com.br" rel="noopener">oi@banconeon.com.br </a>— na falta de um canal específico para tratar sobre segurança — no último dia 30 de dezembro, não foi respondido.</p><p>Em 6 de janeiro, reencaminhei a mensagem. No mesmo dia, recebi resposta de agradecimento, com a afirmação de que o relatório seria repassado à equipe de desenvolvimento. A informação era acompanhada pelo conteúdo dos e-mails que enviei tanto no dia 6 quanto no dia 30, evidenciando que ambos foram recebidos. Muito embora eu houvesse solicitado, não foi oferecida uma previsão para a correção da falha.</p><p>No último sábado (13), enviei um novo e-mail informando sobre a atribuição do identificador CVE-2018–5258 à vulnerabilidade e a minha intenção de publicar os detalhes hoje (15), uma vez que já havia decorrido tempo razoável desde a primeira notificação. Recebi resposta reiterando os agradecimentos e que o caso estava sendo investigado pela equipe de desenvolvimento.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-17.png" class="kg-image" alt="CVE-2018-5258 Writeup: aplicativo do banco Neon para iOS não valida certificados SSL"><figcaption>Ainda não foi disponibilizada atualização com a correção para a falha</figcaption></figure><p>Ainda hoje, às 8h30min da manhã, já após o envio do <em><em>advisory</em></em> para a Full Disclosure, recebi um e-mail do Júlio Dário, CTO do Neon, informando que “o referido bug já estava mapeado em nosso backlog e que a correção já foi efetuada”. No entanto, até o momento da publicação deste texto, não foi lançada uma nova versão do aplicativo na App Store. A mais recente disponível, 1.6.14, lançada há três semanas, é a mesma na qual a falha foi estudada e confirmada.</p><h2 id="advisory"><br>Advisory</h2><!--kg-card-begin: html--><script src="https://gist.github.com/rlaneth/d2203c206d5d5acbdaf6069e78b1d07f.js"></script><!--kg-card-end: html-->]]></content:encoded></item><item><title><![CDATA[Introdução ao D-Bus]]></title><description><![CDATA[Apresentando conceitos e demonstrando na prática as aplicações do sistema de comunicação entre processos]]></description><link>https://radialle.github.io/introducao-ao-d-bus/</link><guid isPermaLink="false">5e8932955873f20001330087</guid><category><![CDATA[Software]]></category><dc:creator><![CDATA[Rodrigo Laneth]]></dc:creator><pubDate>Mon, 27 Nov 2017 03:00:00 GMT</pubDate><media:content url="https://radialle.github.io/content/images/2020/04/0-Ruq2GfPiSH8Oe_09..png" medium="image"/><content:encoded><![CDATA[<img src="https://radialle.github.io/content/images/2020/04/0-Ruq2GfPiSH8Oe_09..png" alt="Introdução ao D-Bus"><p>O <a href="https://www.freedesktop.org/wiki/Software/dbus/" rel="noopener">D-Bus</a> é um sistema de IPC (<em><em>Inter-Process Communication</em></em>, ou comunicação entre processos) criado e mantido como parte do <a href="https://www.freedesktop.org/" rel="noopener">freedesktop.org</a>, projeto dedicado à interoperabilidade e ao desenvolvimento de tecnologias compartilhadas entre os ambientes gráficos para o <a href="https://www.x.org/" rel="noopener">X Window System</a>, incluindo os populares <a href="https://www.gnome.org/" rel="noopener">GNOME</a> e<a href="https://www.kde.org/" rel="noopener"> KDE</a>.</p><p>Criado para atender às necessidades desses dois últimos, o D-Bus é, hoje, utilizado por vários outros projetos, incluindo o servidor de áudio <a href="https://www.freedesktop.org/wiki/Software/PulseAudio/" rel="noopener">PulseAudio</a> e a <em><em>stack</em></em> Bluetooth <a href="http://www.bluez.org/" rel="noopener">BlueZ</a>. Além disso, os <em><em>bindings</em></em> existentes para as mais diversas linguagens de programação facilitam bastante a sua adoção.</p><p>A proposta deste texto é apresentar os conceitos básicos e demonstrar como um desenvolvedor pode fazer uso do sistema. Portanto, não se trata de uma abordagem minuciosa dos detalhes referentes ao seu funcionamento. Materiais recomendados para um maior aprofundamento no tema podem ser encontrados ao final do texto, nas seções “Indo Além” e “Referências”.</p><h1 id="conceitos">Conceitos</h1><p>Muitos dos termos utilizados no âmbito da OOP (<em><em>Object-Oriented Programming</em></em>, ou programação orientada a objetos), como, por exemplo, “objeto” e “método”, são também aplicados ao D-Bus, muito embora para nomear conceitos distintos. Desta forma, é necessário atenção para não confundir os significados.</p><h2 id="bus">Bus</h2><p>Podemos descrever um <em><em>bus</em></em> como um canal através do qual programas se comunicam. Geralmente, e a depender do ambiente analisado, há, por padrão, um <em><em>system bus</em></em>, único e destinado à troca de informações entre todo o sistema operacional, e um <em><em>session bus</em></em> para cada sessão de usuário ativa, onde os dados trafegados se restrigem a ela.</p><p>Cada <em><em>bus</em></em> possui um endereço para acesso, que frequentemente é o caminho de um <em><em>Unix-domain socket</em></em> (soquete de domínio Unix). No entanto, outros esquemas de comunicação podem ser utilizados. É possível, por exemplo, que um <em><em>bus</em></em> esteja associado a uma porta TCP, sendo, assim, acessível por meio do endereço dela.</p><h2 id="bus-name">Bus Name</h2><p>Os <em><em>bus names</em></em> são nomes atribuídos às conexões dos programas a um <em><em>bus</em></em>. São divididos em dois tipos: <em><em>unique connection names</em></em> (nomes únicos de conexão) e <em><em>well-known names</em></em> (nomes conhecidos).</p><p>Os <em><em>unique connection names</em></em> são únicos e imutáveis, atribuídos a cada conexão no momento em que elas são estabelecidas e nunca reutilizados no mesmo <em><em>bus</em></em> ao longo de todo o tempo em que ele existir, mesmo que as conexões a que eles estão associados se encerrem. Se iniciam com dois pontos (“:”), uma característica exclusiva, que não pode ser imitada pelos <em><em>well-known names</em></em>. Exemplo: <strong><strong>:1.72</strong></strong>.</p><p>Os <em><em>well-known names</em></em> são nomes atribuídos às conexões por solicitação dos programas. Constituem-se de dois ou mais elementos separados por pontos (“.”). Por convenção, adotam o formato de nomes de domínio revertidos. Exemplo: <strong><strong>com.radialle.app</strong></strong>.</p><p>Deve-se ressaltar que o termo “<em><em>bus name</em></em>” <strong><strong>não</strong></strong> se refere ao “nome de um <em><em>bus</em></em>”, ainda que possa sugerir esta ideia.</p><h2 id="objeto">Objeto</h2><p>Uma das pontas de qualquer comunicação realizada através do D-Bus é um <em><em>objeto</em></em>, elemento de um programa que se torna acessível aos demais ao ser registrado em um <em><em>bus</em></em>.</p><p>Cada objeto é identificado por um <em><em>object path</em></em> (caminho de objeto) como, por exemplo, <strong><strong>/com/radialle/app/example</strong></strong>. Pelos padrões que seguem, os <em><em>object paths</em></em> se assemelham aos caminhos de sistemas de arquivos em estilo Unix. No entanto, ao contrário do que poderia-se pensar, eles não necessariamente indicam relações hierárquicas.</p><p>Os objetos existem dentro do contexto de uma conexão. Para acessá-los, é necessário conhecer o <em><em>bus name</em></em> ao qual o objeto desejado está associado, bem como o seu <em><em>object path</em></em>. Assim, um <em><em>object path</em></em> precisa ser único dentro de uma mesma conexão, embora possa se repetir no <em><em>bus</em></em>.</p><p>Em todo <em><em>bus</em></em>, há um objeto que representa o próprio <em><em>bus</em></em>. Ele é disponibilizado através conexão de <em><em>bus name</em></em> <strong><strong>org.freedesktop.DBus</strong></strong> e o seu <em><em>object path</em></em> é <strong><strong>/</strong></strong>. Dentre as suas funções, estão a de possibilitar a solicitação de <em><em>well-known names</em></em> e a de permitir que os programas conectados descubram as demais conexões ativas ao <em><em>bus</em></em>.</p><h2 id="proxy">Proxy</h2><p>Um <em><em>proxy</em></em> é uma representação de um objeto registrado em um <em><em>bus</em></em> que existe somente dentro de um programa, sendo de exclusiva responsabilidade do <em><em>binding</em></em> utilizado.</p><p>Em muitos <em><em>bindings</em></em>, o <em><em>proxy</em></em> tem a forma de um objeto nativo da linguagem de programação utilizada, permitindo que o desenvolvedor acesse um objeto do D-Bus de maneira muito similar a como faria com um objeto regular.</p><h2 id="m-todo">Método</h2><p>Os métodos são associados a objetos, e representam operações de um programa que podem ser chamadas pelos demais processos conectados ao mesmo <em><em>bus</em></em>. Assim como as tradicionais funções das linguagens de programação, ou mesmo os métodos da OOP, eles podem requerer argumentos (<em><em>input parameters</em></em>, ou parâmetros de entrada) e retornar dados (<em><em>output parameters</em></em>, ou parâmetros de saída). Se ocorrer um erro durante a execução da operação, eles podem também retornar uma <em><em>exceção</em></em> contendo um nome e uma mensagem de erro.</p><p>Muitos detalhes costumam ser simplificados pelos <em><em>bindings</em></em>. É comum, por exemplo, que a chamada de um método através de um <em><em>proxy</em></em> seja efetuada com argumentos de entrada de tipos nativos da linguagem de programação utilizada, com o processo de conversão para os tipos suportados pelo D-Bus ficando sob responsabilidade da biblioteca. Similarmente, os parâmetros de saída e as exceções do D-Bus também podem ser convertidos para as suas contrapartes nativas, possibilitando o tratamento pelo desenvolvedor da maneira convencional.</p><h2 id="sinal">Sinal</h2><p><em><em>Sinais</em></em> (<em><em>signals</em></em>) são um mecanismo através do qual um objeto pode enviar, a qualquer momento, informações aos programas conectados ao <em><em>bus</em></em>.</p><p>É importante notar, no entanto, que os sinais não são automaticamente recebidos por todos os programas conectados ao <em><em>bus</em></em>; eles precisam se registrar para recebê-los, especificando os sinais desejados. Há, portanto, a possibilidade de um sinal ser emitido sem que existam destinatários registrados e não ser recebido por qualquer conexão.</p><h2 id="interface">Interface</h2><p>Uma interface especifica um conjunto de <em><em>membros</em></em> — ou seja, métodos e sinais — que pode ser implementado por um objeto. A implementação de uma interface é uma promessa de que o objeto conterá todos os membros definidos por ela.</p><p>Diversos objetos podem implementar uma mesma interface, bem como múltiplas interfaces podem ser implementadas por um único objeto. Se membros idênticos forem definidos por duas ou mais interfaces implementadas pelo objeto, um programa que tente acessar qualquer um deles utilizando somente o <em><em>object path</em></em> e o nome não terá qualquer garantia sobre qual será efetivamente acessado. Para evitar este problema, é importante que se especifique, também, a interface à qual pertence o membro desejado.</p><h2 id="propriedade">Propriedade</h2><p>As <em><em>propriedades</em></em> são associadas aos objetos e dedicadas ao armazenamento de informações. Elas podem ser lidas ou modificadas, a depender das permissões que lhe foram atribuídas, pelos programas conectados ao <em><em>bus</em></em>.</p><p>A descoberta e o acesso às propriedades são realizados por meio de membros dos objetos. Uma leitura simples do valor contido em uma delas, por exemplo, seria efetuada através de uma chamada ao método <strong><strong>Get</strong></strong> da interface <strong><strong>org.freedesktop.DBus.Properties</strong></strong>, implementada pelo mesmo objeto ao qual a propriedade estivesse associada.</p><h1 id="pr-tica">Prática</h1><p>Esclarecidos os conceitos básicos relacionados ao D-Bus, devemos passar à prática para fixar o conhecimento e adquirir uma melhor compreensão das possibilidades que o sistema oferece.</p><p>Para os fins deste texto, usaremos exemplos escritos em Python 3.x, que utilizam o <em><em>binding</em></em> <a href="https://github.com/LEW21/pydbus" rel="noopener">pydbus</a> e foram testados em uma instalação do Debian 9 “Stretch”. Eles devem, no entanto, funcionar na maioria dos ambientes Linux, desde que sejam observados os requerimentos do pydbus — inclusive a necessidade da GLib 2.46 e do girepository 1.46 ou superiores para registrar objetos em um <em><em>bus</em></em> — , do interpretador Python e do próprio D-Bus.</p><h2 id="pydbus">pydbus</h2><p>Em sua página do GitHub, o pydbus é definido como uma biblioteca “pythônica” para o D-Bus. Seu <a href="https://github.com/LEW21/pydbus" rel="noopener"><em><em>README</em></em></a> é simples e direto, contendo diversos exemplos de uso básico do <em><em>binding</em></em>. No mesmo repositório há, ainda, um <a href="https://github.com/LEW21/pydbus/blob/master/doc/tutorial.rst" rel="noopener">tutorial</a> com informações mais detalhadas e outros <em><em>scripts</em></em> de demonstração. Muito embora essas leituras não sejam obrigatórias para a compreensão do restante deste texto, elas são, sem dúvida, recomendadas.</p><h2 id="mpris">MPRIS</h2><p>Para facilitar a integração de <em><em>players</em></em> de mídia com outros programas através do D-Bus, foi criada a <a href="https://specifications.freedesktop.org/mpris-spec/latest/" rel="noopener">MPRIS</a> (<em><em>Media Player Remote Interfacing Specification</em></em>).</p><p>Ao definir convenções para a escolha de <em><em>bus names</em></em>, determinar os objetos que devem existir, seus <em><em>paths</em></em>, as interfaces que devem implementar, dentre outros padrões, a especificação simplifica o desenvolvimento de programas que fazem uso das informações e dos serviços oferecidos pelas aplicações dedicadas à reprodução de áudio e vídeo.</p><p>Como exemplo, podemos destacar que a MPRIS, desde a sua versão 2.0 até a 2.2 — a mais recente disponível no momento da elaboração deste texto — determina o uso de um <em><em>unique connection name</em></em> iniciado por <strong><strong>org.mpris.MediaPlayer2.</strong></strong>, o que torna possível obter uma lista de <em><em>players</em></em>compatíveis conectados a um <em><em>bus</em></em> através da aquisição e filtragem de uma lista completa de <em><em>bus names</em></em>.</p><h2 id="pdmtools">pdmtools</h2><p>O <a href="https://github.com/rapidlight/pdmtools" rel="noopener">pdmtools</a> é um conjunto de duas ferramentas em Python criadas especificamente para acompanhar este texto, servindo como exemplo prático do uso do pydbus para interação com outros programas via D-Bus.</p><p>A primeira delas, chamada lsmpris, exibe uma lista contendo os nomes e os <em><em>bus names</em></em> dos <em><em>players</em></em> compatíveis com a MPRIS 2.x conectados ao <em><em>bus</em></em>especificado.</p><p>A segunda, nomeada fakeplayer, simula um <em><em>player</em></em> compatível ao solicitar um <em><em>bus name</em></em> iniciado por <strong><strong>org.mpris.MediaPlayer2.</strong></strong> e registrar um objeto com o <em><em>path</em></em> <strong><strong>/org/mpris/MediaPlayer2</strong></strong> contendo a propriedade <strong><strong>Identity</strong></strong>. Obviamente, esta é a implementação de apenas um pequeno fragmento da MPRIS, útil somente para fins de estudo e para <em><em>debugging</em></em> da lsmpris.</p><h2 id="ferramentas-do-d-bus">Ferramentas do D-Bus</h2><p>Os <em><em>releases</em></em> do D-Bus incluem ferramentas de linha de comando destinadas à interação com o sistema. Dentre elas, encontram-se a <a href="https://dbus.freedesktop.org/doc/dbus-send.1.html" rel="noopener">dbus-send</a>, que possibilita o envio de mensagens aos objetos especificados, e a <a href="https://dbus.freedesktop.org/doc/dbus-monitor.1.html" rel="noopener">dbus-monitor</a>, para monitoramento das informações trafegadas em um <em><em>bus</em></em>.</p><p>Vemos, a seguir, um exemplo de utilização da dbus-send. Nele, a ferramenta é usada para chamar o método <strong><strong>Get</strong></strong> da interface <strong><strong>org.freedesktop.DBus.Properties</strong></strong>, implementada pelo objeto <strong><strong>/org/mpris/MediaPlayer2</strong></strong> associado à conexão que utiliza o <em><em>bus name</em></em><strong><strong>org.mpris.MediaPlayer2.fakeplayer</strong></strong>. Especificam-se, como parâmetros de entrada, as strings “org.mpris.MediaPlayer2” e “Identity”, que correspondem, respectivamente, à interface e ao nome da propriedade cujo valor deseja-se obter.</p><!--kg-card-begin: markdown--><pre><code>dbus-send \
--print-reply \
--dest=org.mpris.MediaPlayer2.fakeplayer \
/org/mpris/MediaPlayer2 \
org.freedesktop.DBus.Properties.Get \
string:&quot;org.mpris.MediaPlayer2&quot; string:&quot;Identity&quot;
</code></pre>
<!--kg-card-end: markdown--><p>Uma das tarefas que podem ser cumpridas com a dbus-monitor é, conforme demonstrado a seguir, a observação dos sinais emitidos por uma determinada conexão. A ferramenta é chamada com um filtro como parâmetro, de maneira que as únicas mensagens trocadas através do <em><em>bus</em></em> a serem exibidas por ela sejam os sinais originados da conexão de <em><em>bus name</em></em><strong><strong>org.mpris.MediaPlayer2.vlc</strong></strong>, normalmente associada a uma instância do <a href="https://www.videolan.org/vlc/" rel="noopener">VLC media player</a>.</p><!--kg-card-begin: markdown--><pre><code>dbus-monitor \
&quot;type='signal',sender='org.mpris.MediaPlayer2.vlc'&quot;
</code></pre>
<!--kg-card-end: markdown--><p>Nos dois exemplos anteriores, não é especificado um <em><em>bus</em></em> ao qual as ferramentas devem se conectar. Para este caso, ambas adotam como padrão o uso do <em><em>session bus</em></em>.</p><h2 id="d-feet">D-Feet</h2><p>Ainda que a possibilidade de interagir com o D-Bus diretamente pela linha de comando seja bastante útil, inclusive para automatização com <em><em>shell scripts</em></em>, não se trata de uma maneira fácil de explorar e compreender as conexões ativas a um <em><em>bus</em></em>, os objetos associados a elas, seus métodos, sinais e propriedades. Uma melhor alternativa é o <a href="https://wiki.gnome.org/Apps/DFeet" rel="noopener">D-Feet</a>, um <em><em>software</em></em> com interface gráfica dedicado às tarefas de <em><em>debugging</em></em> relacionadas ao D-Bus e mantido como parte do projeto GNOME.</p><figure class="kg-card kg-image-card"><img src="https://radialle.github.io/content/images/2020/04/image-13.png" class="kg-image" alt="Introdução ao D-Bus"></figure><p>Por padrão, o D-Feet exibe, no topo de sua janela principal, as abas “System Bus” e “Session Bus”, que, como os nomes indicam, correspondem, respectivamente, ao <em><em>system bus</em></em> e ao <em><em>session bus</em></em> da sessão de usuário ativa. No canto superior direito, um botão hambúrguer dá acesso às opções de conectar a ferramenta a um outro <em><em>bus</em></em>, ou encerrar uma conexão existente.</p><p>Ao lado esquerdo da mesma janela, existe uma lista de <em><em>bus names</em></em>, correspondente à aba selecionada. Clicando sobre um dos itens, surge, do lado direito, uma lista com os objetos associados à conexão e todas as informações referentes a eles.</p><figure class="kg-card kg-image-card"><img src="https://radialle.github.io/content/images/2020/04/image-14.png" class="kg-image" alt="Introdução ao D-Bus"></figure><p>No exemplo acima, vemos o D-Feet exibir o único objeto criado pela fakeplayer, de <em><em>object path</em></em> <strong><strong>/org/mpris/MediaPlayer2</strong></strong>, que, por sua vez, define a propriedade <strong><strong>Identity</strong></strong>, com permissão somente de leitura. Foi efetuado um duplo clique sobre o seu nome para que o valor associado fosse exibido: “Fake Player”.</p><p>Nota-se que a aplicação simplifica o acesso às propriedades, invocando o método e exibindo os resultados de maneira transparente para o usuário. No entanto, como ela também permite chamar métodos, podemos usá-la para acionar o <strong><strong>Get</strong></strong> da interface <strong><strong>org.freedesktop.DBus.Properties</strong></strong>manualmente, se assim desejarmos.</p><figure class="kg-card kg-image-card"><img src="https://radialle.github.io/content/images/2020/04/image-15.png" class="kg-image" alt="Introdução ao D-Bus"></figure><p>Uma das funções que não faz parte da ferramenta até a mais recente versão disponível durante a elaboração deste texto (0.3.11) é a de receber os sinais emitidos, muito embora ela permita visualizar quais deles são definidos pelas interfaces que os objetos implementam.</p><h1 id="indo-al-m">Indo Além</h1><p>Há aspectos mais avançados do D-Bus que, apesar de não detalhados neste texto, merecem ser mencionados, uma vez que podem ser bastante úteis para aqueles que pretendem se aprofundar na utilização do sistema.</p><h2 id="ativa-o">Ativação</h2><p>Um programa com suporte à <em><em>ativação</em></em> via D-Bus não precisa permanecer em execução para receber as mensagens a ele direcionadas; o sistema se encarregará de chamá-lo quando for solicitado.</p><p>O desenvolvimento de um <em><em>software</em></em> compatível com esse recurso envolve a criação de uma <em><em>service file</em></em>, que fornece ao D-Bus informações como o caminho para o programa a ser executado e o <em><em>bus name</em></em> a ser utilizado.</p><p>Detalhes podem ser encontrados em documentos como o tutorial “<a href="https://techbase.kde.org/Development/Tutorials/D-Bus/Autostart_Services" rel="noopener"><em><em>Creating and Installing D-Bus Autostart Services</em></em></a>”, publicado na <a href="https://techbase.kde.org/Welcome_to_KDE_TechBase" rel="noopener">KDE TechBase</a>.</p><h2 id="seguran-a">Segurança</h2><p>Há diversos recursos para ajudar a garantir a segurança dos programas conectados e das informações trocadas por meio do D-Bus.</p><p>O sistema permite que se configure um <em><em>bus</em></em> para requerer autenticação, de forma que aplicações não possam se conectar a ele sem apresentar as credenciais adequadas. Também é possível aplicar uma <em><em>security policy </em></em>(política de segurança), o que permite a filtragem dos dados trafegados por características como origem, destinatário e conteúdo.</p><p>Normalmente, o <em><em>system bus</em></em> adota, por padrão, uma política de segurança bastante restritiva, impedindo, por exemplo, a solicitação de <em><em>bus names</em></em> e a chamada de qualquer método por processos que não tenham sido explicitamente autorizados.</p><p>Mais informações a respeito podem ser encontradas na documentação do <a href="https://dbus.freedesktop.org/doc/dbus-daemon.1.html" rel="noopener">dbus-daemon</a>.</p><h1 id="refer-ncias">Referências</h1><ul><li>“<a href="https://dbus.freedesktop.org/doc/dbus-specification.html" rel="noopener"><em><em>D-Bus Specification</em></em></a>”, especificação do D-Bus</li><li>“<a href="https://www.freedesktop.org/wiki/IntroductionToDBus/" rel="noopener"><em><em>Introduction to D-Bus</em></em></a>”, parte da documentação oficial</li><li>“<a href="https://dbus.freedesktop.org/doc/dbus-tutorial.html" rel="noopener"><em><em>D-Bus Tutorial</em></em></a>”, tutorial oficial</li><li>“<a href="https://pythonhosted.org/txdbus/dbus_overview.html" rel="noopener"><em><em>D-Bus Overview</em></em></a>”, parte do projeto Tx DBus</li><li>“<a href="https://dbus.freedesktop.org/doc/dbus-daemon.1.html" rel="noopener"><em><em>dbus-daemon</em></em></a>”, documentação oficial do dbus-daemon</li><li>“<a href="https://dbus.freedesktop.org/doc/dbus-send.1.html" rel="noopener"><em><em>dbus-send</em></em></a>”, documentação oficial do dbus-send</li><li>“<a href="https://dbus.freedesktop.org/doc/dbus-monitor.1.html" rel="noopener"><em><em>dbus-monitor</em></em></a>”, documentação oficial do dbus-monitor</li></ul>]]></content:encoded></item><item><title><![CDATA[Encapsulamento de Circuitos Integrados]]></title><description><![CDATA[Entenda e descubra o tipo mais adequado para placas a serem montadas manualmente]]></description><link>https://radialle.github.io/encapsulamento-de-circuitos-integrados/</link><guid isPermaLink="false">5e8931865873f20001330066</guid><category><![CDATA[Eletrônica]]></category><dc:creator><![CDATA[Rodrigo Laneth]]></dc:creator><pubDate>Mon, 26 Dec 2016 03:00:00 GMT</pubDate><media:content url="https://radialle.github.io/content/images/2020/04/1-ZO0hn0pdXfMNzKeqrhG4cw.jpeg" medium="image"/><content:encoded><![CDATA[<img src="https://radialle.github.io/content/images/2020/04/1-ZO0hn0pdXfMNzKeqrhG4cw.jpeg" alt="Encapsulamento de Circuitos Integrados"><p><a href="https://commons.wikimedia.org/wiki/File:Integrated_circuit_on_microchip.jpg" rel="noopener">Foto: Stanmar/Wikimedia Commons</a></p><hr><p>Escrevendo sobre a transição <a href="https://radialle.com/do-arduino-ao-avr-e24a303e5b5e" rel="noopener">do Arduino ao AVR</a>, percebi um tema que merecia ser abordado separadamente: a explicação sobre encapsulamento (em inglês, <em><em>package</em></em>) de circuitos integrados.</p><p>Vamos relembrar. Um <strong><strong>circuito integrado</strong></strong> (CI) ou <em><em>integrated circuit</em></em> (IC) é o que se conhece popularmente como chip. Um conjunto de componentes eletrônicos interligados em uma única peça.</p><p>Boa parte deles se parece com o da foto que ilustra este texto: uma pequena caixa preta com “perninhas”. Essa proteção externa do circuito, junto com esses conectores, são o que chamamos de <strong><strong>encapsulamento</strong></strong>.</p><p>Existem muitos tipos de encapsulamento, padronizados e proprietários. Mas se você faz a montagem das suas placas à mão, na grande maioria dos casos, sua preferência será pelo DIP (<em><em>Dual In-line Package</em></em>).</p><p>Ele é desenhado para <strong><strong>encaixe em furos</strong></strong> (<em><em>through-hole</em></em>), e é conveniente não só por facilitar a soldagem manual, mas também por possibilitar que o componente seja colocado diretamente em uma <em><em>protoboard</em></em>.</p><p>Como exemplo, usemos o microcontrolador ATtiny85. Na sua <a href="http://www.atmel.com/devices/attiny85.aspx" rel="noopener">página oficial</a>, há uma lista com os modelos do produto e seus tipos de encapsulamento.</p><p>Quando comprei alguns, optei pelo modelo <strong><strong>20PU</strong></strong>, cujo encapsulamento é listado como <strong><strong>PDIP 8P3 8</strong></strong>.</p><p>O “P” antes do “DIP” vem de “<em><em>Plastic</em></em>”, indicando que a parte externa do componente é de plástico. Do resto do nome, as outras informações que podemos extrair é que o chip tem oito pinos e 0,3" (polegadas) de largura.</p><p>Em qualquer caso, é DIP.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-11.png" class="kg-image" alt="Encapsulamento de Circuitos Integrados"><figcaption>ATtiny85–20PU</figcaption></figure><p>Mas também não é difícil encontrar o mesmo microcontrolador no modelo 20SU, de encapsulamento SOIC (<em><em>Small Outline Integrated Circuit</em></em>). Este é feito para a montagem <strong><strong>sobre a superfície</strong></strong> de uma placa. Os pinos e o espaçamento entre eles são menores.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-12.png" class="kg-image" alt="Encapsulamento de Circuitos Integrados"><figcaption>ATtiny85–20SU (via <a href="http://int.rsdelivers.com/product/atmel/attiny85-20su/atmel-attiny85-20su-8bit-avr-microcontroller-20mhz-8-kb-512-b-flash-8-pin-soic/6962639" rel="noopener">RS Semiconductors</a>)</figcaption></figure><p>Não se pode dizer que é absolutamente impossível soldar essa versão à mão, mas é bastante complicado. Para encaixar na <em><em>protoboard</em></em>, a solução é usar um <a href="https://www.sparkfun.com/products/13655" rel="noopener">adaptador</a> ou fazer uma <a href="http://www.instructables.com/id/Deadbug-an-SMD-ATTiny85/" rel="noopener">gambiarra</a>.</p><p>No mais, se você quiser conhecer outros tipos de encapsulamento existentes, <a href="https://en.wikipedia.org/wiki/List_of_integrated_circuit_packaging_types" rel="noopener">essa lista</a> na Wikipédia em inglês é um bom começo.</p>]]></content:encoded></item><item><title><![CDATA[Do Arduino ao AVR]]></title><description><![CDATA[Migrando da plataforma de prototipagem aos microcontroladores]]></description><link>https://radialle.github.io/do-arduino-ao-avr/</link><guid isPermaLink="false">5e892a226c12510001d1ec17</guid><category><![CDATA[Eletrônica]]></category><dc:creator><![CDATA[Rodrigo Laneth]]></dc:creator><pubDate>Mon, 26 Dec 2016 03:00:00 GMT</pubDate><media:content url="https://radialle.github.io/content/images/2020/04/arduino-leonardo-attiny85-cover.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://radialle.github.io/content/images/2020/04/arduino-leonardo-attiny85-cover.jpg" alt="Do Arduino ao AVR"><p>É difícil encontrar, nos dias de hoje, alguém que se interesse por tecnologia e não conheça o Arduino. Ele ficou famoso ao longo dos últimos anos e protagoniza inúmeros projetos, incluindo <a href="https://www.hackster.io/ryanjgill2/plant-monitoring-system-88ed2b" rel="noopener">sistemas de monitoramento para plantas</a> e <a href="http://hackaday.com/2016/06/04/control-the-real-world-with-an-arduino-enabled-minecraft-mod/" rel="noopener">LEDs controlados via Minecraft</a>.</p><p>Seu sucesso é merecido. A plataforma ajuda e incentiva milhares de pessoas a ingressarem e se desenvolverem no ramo da eletrônica. Basta o conhecimento básico sobre programação para começar a utilizá-la na criação de protótipos e dispositivos eletrônicos.</p><p>Mas temos que admitir: nem toda ideia pode sair da <em><em>protoboard</em></em>dependendo do Arduino. Toda a conveniência que ele oferece tem um custo, e dificilmente encontramos uma situação onde embutir a placa no produto final não faz com que ele fique mais caro, maior, e pareça menos profissional do que poderia ser.</p><p>Se o plano é comercializar o produto em questão, desvantagens como essas não seriam aceitáveis. Para projetos pessoais e trabalhos acadêmicos, depende do que se pretende fazer, mas mesmo quando eles podem ser tolerados, os pontos negativos nunca são desejáveis.</p><p>Foi trabalhando em um experimento que tinha como objetivo a criação de um dispositivo <em><em>wearable</em></em>, no qual nem os menores Arduinos e clones poderiam ser encaixados, que eu vi que era a hora de começar a usar microcontroladores avulsos.</p><h2 id="microcontroladores">Microcontroladores</h2><p>Eles são componentes programáveis, quase como mini-computadores, que podem ser adaptados da forma que melhor se encaixar no circuito.</p><p>Não é coincidência que essa descrição seja parecida com a dos Arduinos. Eles <strong><strong>não são</strong></strong> microcontroladores, mas <strong><strong>contém</strong></strong> um, onde os programas são de fato gravados e executados. O diferencial das placas são os elementos para facilitar o uso, permitindo, por exemplo, a programação diretamente via USB.</p><p>Vejamos o Arduino Uno. Este modelo usa o microcontrolador <a href="http://www.atmel.com/pt/br/devices/ATMEGA328P.aspx" rel="noopener">ATmega328P</a>, presente na placa no local destacado na imagem a seguir.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image.png" class="kg-image" alt="Do Arduino ao AVR"><figcaption>Arduino Uno (foto da placa via <a href="https://blog.arduino.cc/2013/10/23/open-source-matters-in-hardware-too-interview/" rel="noopener">Arduino Blog</a>, licença <a href="https://www.arduino.cc/en/Main/CopyrightNotice" rel="noopener">CC BY-SA 3.0</a>)</figcaption></figure><p>Uma característica que diferencia o Uno dos outros modelos é que o microcontrolador não é soldado nele, mas sim encaixado sobre um soquete, do qual pode ser removido com relativa facilidade.</p><p>Assim, é possível usar a placa apenas para gravar e testar o programa, e, em seguida, utilizar o ATmega328P de forma independente, como demonstra o vídeo a seguir.</p><figure class="kg-card kg-embed-card"><iframe src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FgFtCg7ImpgM%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DgFtCg7ImpgM&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FgFtCg7ImpgM%2Fhqdefault.jpg&amp;key=d04bfffea46d4aeda930ec88cc64b87c&amp;type=text%2Fhtml&amp;schema=youtube" allowfullscreen frameborder="0" height="480" width="854" title="Arduino Microcontroller taken off the board" class="s t u hq ai" scrolling="auto" style="box-sizing: inherit; position: absolute; top: 0px; left: 0px; width: 680px; height: 382.1875px;"></iframe></figure><p><strong><strong>Mas atenção:</strong></strong> se você pretende repetir o feito, tenha em mente que é importante tomar precauções anti-estática antes de manusear o chip, para evitar danificá-lo. Além disso, saiba que ele precisa ser ligado a dois capacitores.</p><p>Um deles deve ser conectado entre o pino 9 e GND (<em><em>ground</em></em>), e o outro entre o 10 e GND, conforme indicação do autor do vídeo. Por mais que o próprio afirme que “costuma funcionar sem” e faça a demonstração dessa forma, não significa que isso seja recomendável.</p><p>Lembre-se de que é importante ter um bom conhecimento em inglês e consultar sempre o <em><em>datasheet</em></em> do componente que você vai utilizar.</p><h2 id="apresentando-os-avrs">Apresentando os AVRs</h2><p>O ATmega328P é parte da família AVR, da Atmel, que inclui as linhas ATtiny e ATxmega, além da própria ATmega. São microcontroladores 8-bits com base na <a href="https://pt.wikipedia.org/wiki/Arquitetura_Harvard#Arquitetura_de_Harvard_modificada" rel="noopener">arquitetura Harvard modificada</a>.</p><p>É importante destacar que a Atmel apresentou, mais recentemente, chips de 32-bits que também levam o nome “AVR”, apesar de não serem tão parecidos com os originais. Para evitar confusão, pode-se usar o termo “AVR”<strong><strong> apenas para os de 8-bits</strong></strong>, como faço aqui, e “AVR32” para os novos, de 32-bits.</p><p>Para escolher e começar a utilizar um AVR, deve-se conhecer os tipos de armazenamento usados por eles. Seguem.</p><ul><li><strong><strong>Memória Flash</strong></strong><br>Persistente, usada para o armazenamento do programa a ser executado pelo microcontrolador.</li><li><strong><strong>SRAM (<em><em>Static Random Access Memory</em></em>)</strong></strong><br>Provê armazenamento temporário para as informações utilizadas pelo programa em execução, similar à memória RAM de um computador comum.</li><li><strong><strong>EEPROM (<em><em>Electrically-Erasable Programmable Read-Only Memory</em></em>)</strong></strong><br>Pode ser usada pelo programa para armazenamento persistente de dados. As informações nela escritas permanecem mesmo após o microcontrolador ser desligado.</li></ul><p>Talvez você já tenha percebido que tudo isso também existe no Arduino. Os programas escritos para a placa são, afinal, armazenados e executados pelo AVR presente nela.</p><p>Um dos momentos em que isto pode ser facilmente notado é logo após a compilação de um <em><em>sketch</em></em> pela Arduino IDE, quando é possível visualizar mensagens referentes à memória Flash e SRAM.</p><figure class="kg-card kg-image-card"><img src="https://radialle.github.io/content/images/2020/04/image-3.png" class="kg-image" alt="Do Arduino ao AVR"></figure><p>Além disso, existe uma <a href="https://www.arduino.cc/en/Reference/EEPROM" rel="noopener">biblioteca</a> para manipulação da EEPROM, distribuída com a Arduino IDE.</p><p>Outro aspecto dos AVRs que deve ser mencionado é a utilização de <strong><strong>fusíveis</strong></strong>para a configuração do chip. As opções variam de acordo com o modelo, mas um exemplo é o controle da velocidade do microcontrolador, e se a fonte de <em><em>clock</em></em> a ser utilizada será a interna ou uma externa.</p><p>E como se configura e programa um AVR, se eles não podem ser ligados diretamente à porta USB do computador? A forma mais comum é através do ISP (<em><em>In-System Programming</em></em>). Para isso, é necessário utilizar um aparelho também chamado de ISP (<em><em>In-System </em></em><strong><strong><em><em>Programmer</em></em></strong></strong>, neste contexto).</p><p>Dentre os ISPs existentes no mercado, está o <a href="http://www.atmel.com/pt/br/tools/AVRISPMKII.aspx" rel="noopener">AVRISP</a>, da própria Atmel. Mas se você tiver um Arduino, provavelmente não vai precisar disso, já que eles geralmente podem servir ao mesmo propósito.</p><p>Quanto ao software, a ferramenta oferecida pela Atmel para a programação dos microcontroladores é a <a href="http://www.atmel.com/microsite/atmel-studio/" rel="noopener">Atmel Studio</a> (antiga AVR Studio), que permite o desenvolvimento em Assembly, C ou C++, e auxilia no processo de gravação do chip.</p><p>Mas como aqui estamos tratando da transição do Arduino ao AVR, falaremos do uso da própria Arduino IDE no lugar da Atmel Studio, o que torna a mudança muito mais confortável para quem já se acostumou com a plataforma.</p><p>Para prosseguir com demonstrações, precisamos determinar um modelo específico de Arduino e de AVR para utilizar. O processo para transformar a placa em um ISP e realizar a gravação do microcontrolador é similar para todos os modelos, mas as variações existem.</p><p>Portanto, este é o momento para deixar de falar em termos gerais e começar a abordar o Arduino Leonardo e o ATtiny85. O primeiro é o Arduino que tenho em mãos, e o segundo, o microcontrolador que escolhi para o experimento do <em><em>wearable</em></em>.</p><h2 id="conhecendo-o-attiny85">Conhecendo o ATtiny85</h2><p>É um microcontrolador barato, que custa, no Brasil, aproximadamente R$10, e de tamanho bastante reduzido. As <a href="http://www.atmel.com/pt/br/Images/Atmel-2586-AVR-8-bit-Microcontroller-ATtiny25-ATtiny45-ATtiny85_Datasheet-Summary.pdf" rel="noopener">especificações</a> do modelo <strong><strong>20PU</strong></strong>, pelo qual optei devido ao <a href="https://radialle.com/encapsulamento-de-circuitos-integrados-5d1ab80ec5f" rel="noopener">encapsulamento</a>, indicam aproximadamente 8 milímetros de largura por 10 de comprimento e 8,6 de altura.</p><p>Ele oferece 8kB de memória Flash, 512 bytes de EEPROM, 512 bytes de SRAM e cinco pinos de E/S (entrada e saída) — seis, se contar com o RESET.</p><p>Sim, pode-se usar o RESET, que normalmente serve para que o ISP possa reiniciar o microcontrolador e gravar nele um novo programa, como um pino de E/S, por meio da configuração do fusível RSTDISBL.</p><p>Porém, há uma dificuldade: fazer isso impossibilita a programação do AVR com um ISP. A partir do momento em que a alteração do fusível é feita, o chip só pode voltar a ser programado com um HVSP (<em><em>High-Voltage Serial Programmer</em></em>), mais caro e difícil de encontrar ou fazer.</p><p>Assim, o melhor é ignorar a possibilidade, a não ser que você realmente precise da função e tenha acesso a, ou esteja disposto a comprar ou montar, um HVSP. Antes, talvez você queira considerar os outros modelos de AVR maiores e com mais pinos, que existem inclusive na linha ATtiny.</p><p>Quanto aos cinco pinos de E/S restantes, dois suportam PWM (<em><em>Pulse-Width Modulation</em></em>) e os outros três podem funcionar como entrada analógica, conforme indicado pela imagem.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-4.png" class="kg-image" alt="Do Arduino ao AVR"><figcaption>Pinos do ATtiny85 (simplificado)</figcaption></figure><p>No esquema acima, há siglas referentes ao ISP: MISO (<em><em>Master In Slave Out</em></em>), que indica o pino usado para envio de dados do ATtiny85 ao programador; MOSI (<em><em>Master Out Slave In</em></em>), para os dados do programador ao ATtiny85; e SCK (<em><em>Serial Clock</em></em>), para sincronização da comunicação.</p><p>Como se descobre a posição correta do chip para identificar os pinos? Bom, normalmente os circuitos integrados — não só os microcontroladores — vêm marcados com um chanfro, da maneira como foi ilustrado acima, ou com uma bolinha ao lado do primeiro pino, ou ambos.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-5.png" class="kg-image" alt="Do Arduino ao AVR"><figcaption>Marcação no ATtiny85–20PU</figcaption></figure><h2 id="programando-o-attiny85">Programando o ATtiny85</h2><p>Há, no Arduino Leonardo, um cabeçalho denominado ICSP (<em><em>In-Circuit Serial Programming</em></em>). Os seis pinos nele existentes correspondem a 5v, GND, RESET, MISO, MOSI e SCK, conforme abaixo.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-6.png" class="kg-image" alt="Do Arduino ao AVR"><figcaption>Cabeçalho ICSP do Arduino Leonardo (foto da placa via <a href="https://www.arduino.cc/en/Main/CopyrightNotice" rel="noopener">Arduino</a>, licença <a href="https://www.arduino.cc/en/Main/CopyrightNotice" rel="noopener">CC BY-SA 3.0</a>)</figcaption></figure><p>Para programar o chip com a placa, o que precisamos fazer é conectar os pinos do Arduino aos do ATtiny85, observando a função de cada um. O MISO deve ser ligado ao MISO, o MOSI ao MOSI, e assim por diante.</p><p><strong><strong><em><em>Plot twist</em></em>: o RESET é exceção.</strong></strong> O do cabeçalho ICSP serve para reiniciar o microcontrolador do Arduino, e não do outro dispositivo. Por esta razão, usaremos o pino 10 para a tarefa.</p><p>Mas antes de prosseguir com as conexões, falemos das preparações necessárias para programar o chip usando a placa e a Arduino IDE. Em primeiro lugar, transformamos o Arduino Leonardo em um ISP seguindo estes passos:</p><ol><li><strong><strong>Abrir o <em><em>sketch</em></em> ArduinoISP na Arduino IDE</strong></strong><br>Ele pode ser encontrado em <code><strong><strong>Arquivo</strong></strong> &gt; <strong><strong>Exemplos</strong></strong> &gt; <strong><strong>ArduinoISP</strong></strong></code>.</li><li><strong><strong>Verificar se o pino 10 será usado como RESET</strong></strong><br>A definição deverá estar correta no <em><em>sketch</em></em>: <code>#define RESET 10</code>.</li><li><strong><strong>Conectar LEDs ao Arduino Leonardo </strong></strong>(opcional)<br>Por padrão, o <em><em>sketch</em></em> usa o pino 9 para um LED de <em><em>heartbeat</em></em>, que mostra que o programador está rodando, o 8 para um indicador de erro, e o 7 para um indicador de comunicação com o microcontrolador. Você pode ligá-los ou modificar os pinos se quiser, mas não é estritamente necessário.</li><li><strong><strong>Carregar o <em><em>sketch</em></em> para a placa</strong></strong><br>Ligar o Arduino Leonardo ao computador, se certificar de que o modelo da placa e a porta estão configurados corretamente na Arduino IDE, e clicar em “Carregar”. Procedimento idêntico ao de qualquer outro <em><em>sketch</em></em>.</li></ol><p>Em seguida, dizemos à Arduino IDE como ela deve se comunicar com o ATtiny85, utilizando o Arduino Leonardo para configurar o chip e instalar programas nele, da seguinte maneira:</p><ol><li><strong><strong>Localizar a pasta de instalação da Arduino IDE</strong></strong><br>Se você usa Windows, tente <code>C:\Arquivos de Programas (x86)\Arduino</code>. No macOS, dê um clique secundário no Arduino.app e escolha “Mostrar Conteúdo do Pacote”.</li><li><strong><strong>Encontrar o arquivo <em><em>programmers.txt</em></em></strong></strong><br>Dentro da pasta de instalação da Arduino IDE, deverá estar em <code>hardware\arduino\avr</code>.<br>Ex.: <code>C:\Arquivos de Programas (x86)\Arduino\hardware\arduino\avr\programmers.txt</code> (Windows); <code>/Applications/Arduino.app/Contents/Java/hardware/arduino/avr/programmers.txt</code>(macOS).</li><li><strong><strong>Adicionar a configuração para usar o Arduino Leonardo como ISP</strong></strong><br>Colocar as linhas a seguir no final do arquivo.</li></ol><!--kg-card-begin: markdown--><pre><code>leonardoisp.name=Leonardo as ISP
leonardoisp.communication=serial
leonardoisp.protocol=arduino
leonardoisp.speed=19200
leonardoisp.program.protocol=arduino
leonardoisp.program.speed=19200
leonardoisp.program.tool=avrdude
leonardoisp.program.extra_params=-P{serial.port} -b{program.speed}
</code></pre>
<!--kg-card-end: markdown--><p>E para finalizar, instalamos o pacote <strong><strong>attiny</strong></strong>, do desenvolvedor <a href="https://github.com/damellis" rel="noopener">David Mellis</a>, na Arduino IDE:</p><ol><li><strong><strong>Adicionar a URL ao Gerenciador de Placas</strong></strong><br>Em <code><strong><strong>Arquivo</strong></strong> &gt; <strong><strong>Preferências</strong></strong></code> (<code><strong><strong>Arduino</strong></strong> &gt; <strong><strong>Preferências</strong></strong></code> no macOS), colar o endereço a seguir no campo “URLs Adicionais de Gerenciadores de Placas”.<br><code><a href="https://raw.githubusercontent.com/damellis/attiny/ide-1.6.x-boards-manager/package_damellis_attiny_index.json" rel="noopener">https://raw.githubusercontent.com/damellis/attiny/ide-1.6.x-boards-manager/package_damellis_attiny_index.json</a></code></li><li><strong><strong>Abrir o Gerenciador de Placas da Arduino IDE</strong></strong><br>Ele se encontra em <code><strong><strong>Ferramentas</strong></strong> &gt; <strong><strong>Placa</strong></strong> &gt; <strong><strong>Gerenciador de Placas</strong></strong></code>.</li><li><strong><strong>Pesquisar por “attiny”</strong></strong><br>Basta digitar o nome na caixa de busca na parte superior da janela do gerenciador.</li><li><strong><strong>Instalar a última versão do pacote <em><em>attiny by David A. Mellis</em></em></strong></strong><br>Clicar sobre o elemento, certificar-se de que a versão mais recente está selecionada na caixa de seleção e clicar em “Instalar”.</li></ol><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-7.png" class="kg-image" alt="Do Arduino ao AVR"><figcaption>Instalação do pacote attiny pelo Gerenciador de Placas da Arduino IDE</figcaption></figure><p>Agora estamos prontos para fazer as ligações e começar a interagir com o ATtiny85. Segue o esquema.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-8.png" class="kg-image" alt="Do Arduino ao AVR"><figcaption>Esquema de ligação do Arduino Leonardo com o ATtiny85</figcaption></figure><p>Com os fios ligados e o Arduino Leonardo conectado à porta USB do computador, abrimos a Arduino IDE, e, no menu “Ferramentas”, selecionamos as opções corretas de placa, processador, porta, <em><em>clock</em></em> e programador.</p><p>Para rodar o código compilado pela Arduino IDE, o chip precisa do <em><em>bootloader </em></em>adequado. Felizmente, para gravá-lo, basta clicar em “Gravar Bootloader”, ainda no menu “Ferramentas”. Isto também deve ser feito sempre que mudarmos o <em><em>clock</em></em>, para registrar no ATtiny85 o novo parâmetro.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-9.png" class="kg-image" alt="Do Arduino ao AVR"><figcaption>Menu “Ferramentas” da Arduino IDE</figcaption></figure><p>Sem uma fonte de <em><em>clock</em></em> externa, o ATtiny85 pode ser configurado para rodar a 1 MHz, 8 MHz ou 16 MHz (as opções que começam com “<em><em>Internal</em></em>” no menu da Arduino IDE). Com ela (“<em><em>External</em></em>”), pode-se escolher entre 8 MHz, 16 MHz ou 20 MHz.</p><p><strong><strong>Muita atenção aqui.</strong></strong> Se configurarmos o microcontrolador para usar uma fonte externa, ele não funcionará e não poderá ser reprogramado sem que ela esteja, de fato, presente. Portanto, cuidado.</p><p>Se houver algum erro ao gravar o <em><em>bootloader</em></em>, verifique a ligação entre a placa e o microcontrolador — não é difícil se enganar com os fios — e as opções escolhidas. Também é válido tentar desconectar e reconectar o Arduino Leonardo à porta USB, e até reinciar a Arduino IDE.</p><p>Agora, se a mensagem “gravação do bootloader concluída” for exibida, o ATtiny85 está pronto para receber o seu programa.</p><h2 id="pisca-pisca">Pisca-pisca</h2><p>Lembra do Blink, aquele <em><em>sketch</em></em> que vem pré-carregado e é basicamente o “Hello World” da programação de Arduinos?</p><p>Ele pode ser aberto na Arduino IDE, em <code><strong><strong>Arquivo</strong></strong> &gt; <strong><strong>Exemplos</strong></strong> &gt; <strong><strong>Basics</strong></strong> &gt; <strong><strong>Blink</strong></strong></code>, e, conforme sua própria descrição, o que ele faz é ligar um LED por um segundo, depois desligá-lo por mais um, e repetir indefinidamente.</p><p>A maioria dos Arduinos tem um LED embutido que pode ser usado com este <em><em>sketch</em></em>. O ATtiny85 não.</p><p>Portanto, se queremos usar o Blink para comprovar que o microcontrolador já está completamente preparado, vamos precisar de um LED e um resistor de pelo menos 220 Ohm.</p><p>Ligamos conforme o esquema e carregamos no ATtiny85 o código a seguir, tudo como você provavelmente já está esperando.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://radialle.github.io/content/images/2020/04/image-10.png" class="kg-image" alt="Do Arduino ao AVR"><figcaption>Sinta-se livre para trocar o Arduino por outra fonte de alimentação</figcaption></figure><!--kg-card-begin: markdown--><pre><code>/*
  Blink
  Turns on an LED on for one second, then off for one second,
  repeatedly.
  This example code is in the public domain.
  modified 23 Dec 2016
  by Rodrigo Menezes (for Radialle)
  modified 8 May 2014
  by Scott Fitzgerald
  
  modified 2 Sep 2016
  by Arturo Guadalupi
*/
void setup() {
  pinMode(4, OUTPUT);
}
void loop() {
  digitalWrite(4, HIGH);
  delay(1000);
  digitalWrite(4, LOW);
  delay(1000);
}
</code></pre>
<!--kg-card-end: markdown--><p>Você poderia mudar o pino, claro. Bastaria ligar o resistor em outro, e alterar o <em><em>sketch</em></em> de acordo. Apenas lembre-se de que a numeração dos pinos no código é diferente da física: o pino ao lado do RESET, por exemplo, é o segundo, e no programa deve ser referido como 3.</p><p>Na dúvida, consulte o esquema da seção “Conhecendo o ATtiny85”, ou o <a href="http://www.atmel.com/images/atmel-2586-avr-8-bit-microcontroller-attiny25-attiny45-attiny85_datasheet.pdf" rel="noopener"><em><em>datasheet</em></em></a>.</p><h2 id="conclus-o">Conclusão</h2><p>O Arduino certamente continuará como a sua plataforma de prototipagem favorita, mas agora você já conhece uma alternativa para deixar os seus projetos muito melhores do que antes.</p><p>Há muito a ganhar explorando o universo dos microcontroladores, e espero que este texto tenha lhe servido bem como uma introdução a essa jornada.</p>]]></content:encoded></item></channel></rss>