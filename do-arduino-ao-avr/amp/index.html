<!DOCTYPE html>
<html ⚡>
<head>
    <meta charset="utf-8">

    <title>Do Arduino ao AVR</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <meta name="description" content="Migrando da plataforma de prototipagem aos microcontroladores" />
    <link rel="shortcut icon" href="/favicon.png" type="image/png" />
    <link rel="canonical" href="https://radialle.github.io/do-arduino-ao-avr/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="Radialle" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Do Arduino ao AVR" />
    <meta property="og:description" content="Migrando da plataforma de prototipagem aos microcontroladores" />
    <meta property="og:url" content="https://radialle.github.io/do-arduino-ao-avr/" />
    <meta property="og:image" content="https://radialle.github.io/content/images/2020/04/arduino-leonardo-attiny85-cover.jpg" />
    <meta property="article:published_time" content="2016-12-26T00:00:00.000Z" />
    <meta property="article:modified_time" content="2020-04-05T01:23:03.000Z" />
    <meta property="article:tag" content="Eletrônica" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Do Arduino ao AVR" />
    <meta name="twitter:description" content="Migrando da plataforma de prototipagem aos microcontroladores" />
    <meta name="twitter:url" content="https://radialle.github.io/do-arduino-ao-avr/" />
    <meta name="twitter:image" content="https://radialle.github.io/content/images/2020/04/arduino-leonardo-attiny85-cover.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Rodrigo Laneth" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Eletrônica" />
    <meta name="twitter:creator" content="@rlaneth" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="1058" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Radialle",
        "url": "https://radialle.github.io/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://radialle.github.io/content/images/2020/04/blog-icon.svg"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Rodrigo Laneth",
        "image": {
            "@type": "ImageObject",
            "url": "https://radialle.github.io/content/images/2020/04/Unknown-2.jpeg",
            "width": 640,
            "height": 640
        },
        "url": "https://radialle.github.io/author/rlaneth/",
        "sameAs": [
            "https://rlaneth.com",
            "https://twitter.com/rlaneth"
        ]
    },
    "headline": "Do Arduino ao AVR",
    "url": "https://radialle.github.io/do-arduino-ao-avr/",
    "datePublished": "2016-12-26T00:00:00.000Z",
    "dateModified": "2020-04-05T01:23:03.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://radialle.github.io/content/images/2020/04/arduino-leonardo-attiny85-cover.jpg",
        "width": 1400,
        "height": 1058
    },
    "keywords": "Eletrônica",
    "description": "Migrando da plataforma de prototipagem aos microcontroladores",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://radialle.github.io/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.12" />
    <link rel="alternate" type="application/rss+xml" title="Radialle" href="https://radialle.github.io/rss/" />

    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,600,400" />
    <style amp-custom>html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{margin:0.67em 0;font-size:2em}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{position:relative;vertical-align:baseline;font-size:75%;line-height:0}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}amp-img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace, monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;color:inherit;font:inherit}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{cursor:pointer;-webkit-appearance:button}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{margin:0 2px;padding:0.35em 0.625em 0.75em;border:1px solid #c0c0c0}legend{padding:0;border:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}html{max-height:100%;height:100%;font-size:62.5%;-webkit-tap-highlight-color:rgba(0, 0, 0, 0)}body{max-height:100%;height:100%;color:#3a4145;background:#f4f8fb;letter-spacing:0.01rem;font-family:"Merriweather", serif;font-size:1.8rem;line-height:1.75em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{margin:0 0 0.3em 0;color:#2e2e2e;font-family:"Open Sans", sans-serif;line-height:1.15em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1;-moz-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1;-o-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1}h1{text-indent:-2px;letter-spacing:-1px;font-size:2.6rem}h2{letter-spacing:0;font-size:2.4rem}h3{letter-spacing:-0.6px;font-size:2.1rem}h4{font-size:1.9rem}h5{font-size:1.8rem}h6{font-size:1.8rem}a{color:#4a4a4a}a:hover{color:#111}p,ul,ol,dl{margin:0 0 2.5rem 0;font-size:1.5rem;text-rendering:geometricPrecision;-webkit-font-feature-settings:"liga" 1, "onum" 1, "kern" 1;-moz-font-feature-settings:"liga" 1, "onum" 1, "kern" 1;-o-font-feature-settings:"liga" 1, "onum" 1, "kern" 1}ol,ul{padding-left:2em}ol ol,ul ul,ul ol,ol ul{margin:0 0 0.4em 0;padding-left:2em}dl dt{float:left;clear:left;overflow:hidden;margin-bottom:1em;width:180px;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd{margin-bottom:1em;margin-left:200px}li{margin:0.4em 0}li li{margin:0}hr{display:block;margin:1.75em 0;padding:0;height:1px;border:0;border-top:#efefef 1px solid}blockquote{box-sizing:border-box;margin:1.75em 0 1.75em 0;padding:0 0 0 1.75em;border-left:#4a4a4a 0.4em solid;-moz-box-sizing:border-box}blockquote p{margin:0.8em 0;font-style:italic}blockquote small{display:inline-block;margin:0.8em 0 0.8em 1.5em;color:#ccc;font-size:0.9em}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:normal}mark{background-color:#fdffb6}code,tt{padding:1px 3px;border:#e3edf3 1px solid;background:#f7fafb;border-radius:2px;white-space:pre-wrap;font-family:Inconsolata, monospace, sans-serif;font-size:0.85em;font-feature-settings:"liga" 0;-webkit-font-feature-settings:"liga" 0;-moz-font-feature-settings:"liga" 0}pre{overflow:auto;box-sizing:border-box;margin:0 0 1.75em 0;padding:10px;width:100%;border:#e3edf3 1px solid;background:#f7fafb;border-radius:3px;white-space:pre;font-family:Inconsolata, monospace, sans-serif;font-size:0.9em;-moz-box-sizing:border-box}pre code,pre tt{padding:0;border:none;background:transparent;white-space:pre-wrap;font-size:inherit}kbd{display:inline-block;margin-bottom:0.4em;padding:1px 8px;border:#ccc 1px solid;background:#f4f4f4;border-radius:4px;box-shadow:0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 0 #fff inset;color:#666;text-shadow:#fff 0 1px 0;font-size:0.9em;font-weight:700}table{box-sizing:border-box;margin:1.75em 0;max-width:100%;width:100%;background-color:transparent;-moz-box-sizing:border-box}table th,table td{padding:8px;border-top:#efefef 1px solid;vertical-align:top;text-align:left;line-height:20px}table th{color:#000}table caption + thead tr:first-child th,table caption + thead tr:first-child td,table colgroup + thead tr:first-child th,table colgroup + thead tr:first-child td,table thead:first-child tr:first-child th,table thead:first-child tr:first-child td{border-top:0}table tbody + tbody{border-top:#efefef 2px solid}table table table{background-color:#fff}table tbody > tr:nth-child(odd) > td,table tbody > tr:nth-child(odd) > th{background-color:#f6f6f6}table.plain tbody > tr:nth-child(odd) > td,table.plain tbody > tr:nth-child(odd) > th{background:transparent}iframe,amp-iframe,.fluid-width-video-wrapper{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper amp-iframe{margin:0}textarea,select,input{margin:0 0 5px 0;padding:6px 9px;width:260px;outline:0;border:#e7eef2 1px solid;background:#fff;border-radius:4px;box-shadow:none;font-family:"Open Sans", sans-serif;font-size:1.6rem;line-height:1.4em;font-weight:100;-webkit-appearance:none}textarea{min-width:250px;min-height:80px;max-width:340px;width:100%;height:auto}input[type="text"]:focus,input[type="email"]:focus,input[type="search"]:focus,input[type="tel"]:focus,input[type="url"]:focus,input[type="password"]:focus,input[type="number"]:focus,input[type="date"]:focus,input[type="month"]:focus,input[type="week"]:focus,input[type="time"]:focus,input[type="datetime"]:focus,input[type="datetime-local"]:focus,textarea:focus{outline:none;outline-width:0;border:#bbc7cc 1px solid;background:#fff}select{width:270px;height:30px;line-height:30px}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.main-header{position:relative;display:table;overflow:hidden;box-sizing:border-box;width:100%;height:50px;background:#5ba4e5 no-repeat center center;background-size:cover;text-align:left;-webkit-box-sizing:border-box;-moz-box-sizing:border-box}.content{background:#fff;padding-top:15px}.blog-title,.content{margin:auto;max-width:600px}.blog-title a{display:block;padding-right:16px;padding-left:16px;height:50px;color:#fff;text-decoration:none;font-family:"Open Sans", sans-serif;font-size:16px;line-height:50px;font-weight:600}.post{position:relative;margin-top:0;margin-right:16px;margin-left:16px;padding-bottom:0;max-width:100%;border-bottom:#ebf2f6 1px solid;word-wrap:break-word;font-size:0.95em;line-height:1.65em}.post-header{margin-bottom:1rem}.post-title{margin-bottom:0}.post-title a{text-decoration:none}.post-meta{display:block;margin:3px 0 0 0;color:#9eabb3;font-family:"Open Sans", sans-serif;font-size:1.3rem;line-height:2.2rem}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.post-meta .author{margin:0;font-size:1.3rem;line-height:1.3em}.post-date{display:inline-block;text-transform:uppercase;white-space:nowrap;font-size:1.2rem;line-height:1.2em}.post-image{margin:0;padding-top:3rem;padding-bottom:30px;border-top:1px #E8E8E8 solid}.post-content amp-img,.post-content amp-anim{position:relative;left:50%;display:block;padding:0;min-width:0;max-width:112%;width:calc(100% + 32px);height:auto;transform:translateX(-50%);-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%)}.footnotes{font-size:1.3rem;line-height:1.6em;font-style:italic}.footnotes li{margin:0.6rem 0}.footnotes p{margin:0}.footnotes p a:last-child{text-decoration:none}.site-footer{position:relative;margin:0 auto 20px auto;padding:1rem 15px;max-width:600px;color:rgba(0,0,0,0.5);font-family:"Open Sans", sans-serif;font-size:1.1rem;line-height:1.75em}.site-footer a{color:rgba(0,0,0,0.5);text-decoration:none;font-weight:bold}.site-footer a:hover{border-bottom:#bbc7cc 1px solid}.poweredby{display:block;float:right;width:45%;text-align:right}.copyright{display:block;float:left;width:45%}</style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    <script async custom-element="amp-iframe" src="https://cdn.ampproject.org/v0/amp-iframe-0.1.js"></script>

</head>

<body class="amp-template">
    <header class="main-header">
        <nav class="blog-title">
            <a href="https://radialle.github.io">Radialle</a>
        </nav>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Do Arduino ao AVR</h1>
                <section class="post-meta">
                    <p class="author">by <a href="/author/rlaneth/">Rodrigo Laneth</a></p>
                    <time class="post-date" datetime="2016-12-25">2016-12-25</time>
                </section>
            </header>
            <figure class="post-image">
                <amp-img src="https://radialle.github.io/content/images/2020/04/arduino-leonardo-attiny85-cover.jpg" width="600" height="400" layout="responsive"></amp-img>
            </figure>
            <section class="post-content">

                <p>É difícil encontrar, nos dias de hoje, alguém que se interesse por tecnologia e não conheça o Arduino. Ele ficou famoso ao longo dos últimos anos e protagoniza inúmeros projetos, incluindo <a href="https://www.hackster.io/ryanjgill2/plant-monitoring-system-88ed2b" rel="noopener">sistemas de monitoramento para plantas</a> e <a href="http://hackaday.com/2016/06/04/control-the-real-world-with-an-arduino-enabled-minecraft-mod/" rel="noopener">LEDs controlados via Minecraft</a>.</p><p>Seu sucesso é merecido. A plataforma ajuda e incentiva milhares de pessoas a ingressarem e se desenvolverem no ramo da eletrônica. Basta o conhecimento básico sobre programação para começar a utilizá-la na criação de protótipos e dispositivos eletrônicos.</p><p>Mas temos que admitir: nem toda ideia pode sair da <em><em>protoboard</em></em>dependendo do Arduino. Toda a conveniência que ele oferece tem um custo, e dificilmente encontramos uma situação onde embutir a placa no produto final não faz com que ele fique mais caro, maior, e pareça menos profissional do que poderia ser.</p><p>Se o plano é comercializar o produto em questão, desvantagens como essas não seriam aceitáveis. Para projetos pessoais e trabalhos acadêmicos, depende do que se pretende fazer, mas mesmo quando eles podem ser tolerados, os pontos negativos nunca são desejáveis.</p><p>Foi trabalhando em um experimento que tinha como objetivo a criação de um dispositivo <em><em>wearable</em></em>, no qual nem os menores Arduinos e clones poderiam ser encaixados, que eu vi que era a hora de começar a usar microcontroladores avulsos.</p><h2 id="microcontroladores">Microcontroladores</h2><p>Eles são componentes programáveis, quase como mini-computadores, que podem ser adaptados da forma que melhor se encaixar no circuito.</p><p>Não é coincidência que essa descrição seja parecida com a dos Arduinos. Eles <strong><strong>não são</strong></strong> microcontroladores, mas <strong><strong>contém</strong></strong> um, onde os programas são de fato gravados e executados. O diferencial das placas são os elementos para facilitar o uso, permitindo, por exemplo, a programação diretamente via USB.</p><p>Vejamos o Arduino Uno. Este modelo usa o microcontrolador <a href="http://www.atmel.com/pt/br/devices/ATMEGA328P.aspx" rel="noopener">ATmega328P</a>, presente na placa no local destacado na imagem a seguir.</p><figure class="kg-card kg-image-card kg-card-hascaption"><figcaption>Arduino Uno (foto da placa via <a href="https://blog.arduino.cc/2013/10/23/open-source-matters-in-hardware-too-interview/" rel="noopener">Arduino Blog</a>, licença <a href="https://www.arduino.cc/en/Main/CopyrightNotice" rel="noopener">CC BY-SA 3.0</a>)</figcaption></figure><p>Uma característica que diferencia o Uno dos outros modelos é que o microcontrolador não é soldado nele, mas sim encaixado sobre um soquete, do qual pode ser removido com relativa facilidade.</p><p>Assim, é possível usar a placa apenas para gravar e testar o programa, e, em seguida, utilizar o ATmega328P de forma independente, como demonstra o vídeo a seguir.</p><figure class="kg-card kg-embed-card"><amp-iframe src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FgFtCg7ImpgM%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DgFtCg7ImpgM&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FgFtCg7ImpgM%2Fhqdefault.jpg&amp;key=d04bfffea46d4aeda930ec88cc64b87c&amp;type=text%2Fhtml&amp;schema=youtube" allowfullscreen frameborder="0" height="480" width="854" title="Arduino Microcontroller taken off the board" class="s t u hq ai" sandbox="allow-scripts allow-same-origin" layout="responsive"></amp-iframe></figure><p><strong><strong>Mas atenção:</strong></strong> se você pretende repetir o feito, tenha em mente que é importante tomar precauções anti-estática antes de manusear o chip, para evitar danificá-lo. Além disso, saiba que ele precisa ser ligado a dois capacitores.</p><p>Um deles deve ser conectado entre o pino 9 e GND (<em><em>ground</em></em>), e o outro entre o 10 e GND, conforme indicação do autor do vídeo. Por mais que o próprio afirme que “costuma funcionar sem” e faça a demonstração dessa forma, não significa que isso seja recomendável.</p><p>Lembre-se de que é importante ter um bom conhecimento em inglês e consultar sempre o <em><em>datasheet</em></em> do componente que você vai utilizar.</p><h2 id="apresentando-os-avrs">Apresentando os AVRs</h2><p>O ATmega328P é parte da família AVR, da Atmel, que inclui as linhas ATtiny e ATxmega, além da própria ATmega. São microcontroladores 8-bits com base na <a href="https://pt.wikipedia.org/wiki/Arquitetura_Harvard#Arquitetura_de_Harvard_modificada" rel="noopener">arquitetura Harvard modificada</a>.</p><p>É importante destacar que a Atmel apresentou, mais recentemente, chips de 32-bits que também levam o nome “AVR”, apesar de não serem tão parecidos com os originais. Para evitar confusão, pode-se usar o termo “AVR”<strong><strong> apenas para os de 8-bits</strong></strong>, como faço aqui, e “AVR32” para os novos, de 32-bits.</p><p>Para escolher e começar a utilizar um AVR, deve-se conhecer os tipos de armazenamento usados por eles. Seguem.</p><ul><li><strong><strong>Memória Flash</strong></strong><br />Persistente, usada para o armazenamento do programa a ser executado pelo microcontrolador.</li><li><strong><strong>SRAM (<em><em>Static Random Access Memory</em></em>)</strong></strong><br />Provê armazenamento temporário para as informações utilizadas pelo programa em execução, similar à memória RAM de um computador comum.</li><li><strong><strong>EEPROM (<em><em>Electrically-Erasable Programmable Read-Only Memory</em></em>)</strong></strong><br />Pode ser usada pelo programa para armazenamento persistente de dados. As informações nela escritas permanecem mesmo após o microcontrolador ser desligado.</li></ul><p>Talvez você já tenha percebido que tudo isso também existe no Arduino. Os programas escritos para a placa são, afinal, armazenados e executados pelo AVR presente nela.</p><p>Um dos momentos em que isto pode ser facilmente notado é logo após a compilação de um <em><em>sketch</em></em> pela Arduino IDE, quando é possível visualizar mensagens referentes à memória Flash e SRAM.</p><figure class="kg-card kg-image-card"></figure><p>Além disso, existe uma <a href="https://www.arduino.cc/en/Reference/EEPROM" rel="noopener">biblioteca</a> para manipulação da EEPROM, distribuída com a Arduino IDE.</p><p>Outro aspecto dos AVRs que deve ser mencionado é a utilização de <strong><strong>fusíveis</strong></strong>para a configuração do chip. As opções variam de acordo com o modelo, mas um exemplo é o controle da velocidade do microcontrolador, e se a fonte de <em><em>clock</em></em> a ser utilizada será a interna ou uma externa.</p><p>E como se configura e programa um AVR, se eles não podem ser ligados diretamente à porta USB do computador? A forma mais comum é através do ISP (<em><em>In-System Programming</em></em>). Para isso, é necessário utilizar um aparelho também chamado de ISP (<em><em>In-System </em></em><strong><strong><em><em>Programmer</em></em></strong></strong>, neste contexto).</p><p>Dentre os ISPs existentes no mercado, está o <a href="http://www.atmel.com/pt/br/tools/AVRISPMKII.aspx" rel="noopener">AVRISP</a>, da própria Atmel. Mas se você tiver um Arduino, provavelmente não vai precisar disso, já que eles geralmente podem servir ao mesmo propósito.</p><p>Quanto ao software, a ferramenta oferecida pela Atmel para a programação dos microcontroladores é a <a href="http://www.atmel.com/microsite/atmel-studio/" rel="noopener">Atmel Studio</a> (antiga AVR Studio), que permite o desenvolvimento em Assembly, C ou C++, e auxilia no processo de gravação do chip.</p><p>Mas como aqui estamos tratando da transição do Arduino ao AVR, falaremos do uso da própria Arduino IDE no lugar da Atmel Studio, o que torna a mudança muito mais confortável para quem já se acostumou com a plataforma.</p><p>Para prosseguir com demonstrações, precisamos determinar um modelo específico de Arduino e de AVR para utilizar. O processo para transformar a placa em um ISP e realizar a gravação do microcontrolador é similar para todos os modelos, mas as variações existem.</p><p>Portanto, este é o momento para deixar de falar em termos gerais e começar a abordar o Arduino Leonardo e o ATtiny85. O primeiro é o Arduino que tenho em mãos, e o segundo, o microcontrolador que escolhi para o experimento do <em><em>wearable</em></em>.</p><h2 id="conhecendo-o-attiny85">Conhecendo o ATtiny85</h2><p>É um microcontrolador barato, que custa, no Brasil, aproximadamente R$10, e de tamanho bastante reduzido. As <a href="http://www.atmel.com/pt/br/Images/Atmel-2586-AVR-8-bit-Microcontroller-ATtiny25-ATtiny45-ATtiny85_Datasheet-Summary.pdf" rel="noopener">especificações</a> do modelo <strong><strong>20PU</strong></strong>, pelo qual optei devido ao <a href="https://radialle.com/encapsulamento-de-circuitos-integrados-5d1ab80ec5f" rel="noopener">encapsulamento</a>, indicam aproximadamente 8 milímetros de largura por 10 de comprimento e 8,6 de altura.</p><p>Ele oferece 8kB de memória Flash, 512 bytes de EEPROM, 512 bytes de SRAM e cinco pinos de E/S (entrada e saída) — seis, se contar com o RESET.</p><p>Sim, pode-se usar o RESET, que normalmente serve para que o ISP possa reiniciar o microcontrolador e gravar nele um novo programa, como um pino de E/S, por meio da configuração do fusível RSTDISBL.</p><p>Porém, há uma dificuldade: fazer isso impossibilita a programação do AVR com um ISP. A partir do momento em que a alteração do fusível é feita, o chip só pode voltar a ser programado com um HVSP (<em><em>High-Voltage Serial Programmer</em></em>), mais caro e difícil de encontrar ou fazer.</p><p>Assim, o melhor é ignorar a possibilidade, a não ser que você realmente precise da função e tenha acesso a, ou esteja disposto a comprar ou montar, um HVSP. Antes, talvez você queira considerar os outros modelos de AVR maiores e com mais pinos, que existem inclusive na linha ATtiny.</p><p>Quanto aos cinco pinos de E/S restantes, dois suportam PWM (<em><em>Pulse-Width Modulation</em></em>) e os outros três podem funcionar como entrada analógica, conforme indicado pela imagem.</p><figure class="kg-card kg-image-card kg-card-hascaption"><figcaption>Pinos do ATtiny85 (simplificado)</figcaption></figure><p>No esquema acima, há siglas referentes ao ISP: MISO (<em><em>Master In Slave Out</em></em>), que indica o pino usado para envio de dados do ATtiny85 ao programador; MOSI (<em><em>Master Out Slave In</em></em>), para os dados do programador ao ATtiny85; e SCK (<em><em>Serial Clock</em></em>), para sincronização da comunicação.</p><p>Como se descobre a posição correta do chip para identificar os pinos? Bom, normalmente os circuitos integrados — não só os microcontroladores — vêm marcados com um chanfro, da maneira como foi ilustrado acima, ou com uma bolinha ao lado do primeiro pino, ou ambos.</p><figure class="kg-card kg-image-card kg-card-hascaption"><figcaption>Marcação no ATtiny85–20PU</figcaption></figure><h2 id="programando-o-attiny85">Programando o ATtiny85</h2><p>Há, no Arduino Leonardo, um cabeçalho denominado ICSP (<em><em>In-Circuit Serial Programming</em></em>). Os seis pinos nele existentes correspondem a 5v, GND, RESET, MISO, MOSI e SCK, conforme abaixo.</p><figure class="kg-card kg-image-card kg-card-hascaption"><figcaption>Cabeçalho ICSP do Arduino Leonardo (foto da placa via <a href="https://www.arduino.cc/en/Main/CopyrightNotice" rel="noopener">Arduino</a>, licença <a href="https://www.arduino.cc/en/Main/CopyrightNotice" rel="noopener">CC BY-SA 3.0</a>)</figcaption></figure><p>Para programar o chip com a placa, o que precisamos fazer é conectar os pinos do Arduino aos do ATtiny85, observando a função de cada um. O MISO deve ser ligado ao MISO, o MOSI ao MOSI, e assim por diante.</p><p><strong><strong><em><em>Plot twist</em></em>: o RESET é exceção.</strong></strong> O do cabeçalho ICSP serve para reiniciar o microcontrolador do Arduino, e não do outro dispositivo. Por esta razão, usaremos o pino 10 para a tarefa.</p><p>Mas antes de prosseguir com as conexões, falemos das preparações necessárias para programar o chip usando a placa e a Arduino IDE. Em primeiro lugar, transformamos o Arduino Leonardo em um ISP seguindo estes passos:</p><ol><li><strong><strong>Abrir o <em><em>sketch</em></em> ArduinoISP na Arduino IDE</strong></strong><br />Ele pode ser encontrado em <code><strong><strong>Arquivo</strong></strong> &gt; <strong><strong>Exemplos</strong></strong> &gt; <strong><strong>ArduinoISP</strong></strong></code>.</li><li><strong><strong>Verificar se o pino 10 será usado como RESET</strong></strong><br />A definição deverá estar correta no <em><em>sketch</em></em>: <code>#define RESET 10</code>.</li><li><strong><strong>Conectar LEDs ao Arduino Leonardo </strong></strong>(opcional)<br />Por padrão, o <em><em>sketch</em></em> usa o pino 9 para um LED de <em><em>heartbeat</em></em>, que mostra que o programador está rodando, o 8 para um indicador de erro, e o 7 para um indicador de comunicação com o microcontrolador. Você pode ligá-los ou modificar os pinos se quiser, mas não é estritamente necessário.</li><li><strong><strong>Carregar o <em><em>sketch</em></em> para a placa</strong></strong><br />Ligar o Arduino Leonardo ao computador, se certificar de que o modelo da placa e a porta estão configurados corretamente na Arduino IDE, e clicar em “Carregar”. Procedimento idêntico ao de qualquer outro <em><em>sketch</em></em>.</li></ol><p>Em seguida, dizemos à Arduino IDE como ela deve se comunicar com o ATtiny85, utilizando o Arduino Leonardo para configurar o chip e instalar programas nele, da seguinte maneira:</p><ol><li><strong><strong>Localizar a pasta de instalação da Arduino IDE</strong></strong><br />Se você usa Windows, tente <code>C:\Arquivos de Programas (x86)\Arduino</code>. No macOS, dê um clique secundário no Arduino.app e escolha “Mostrar Conteúdo do Pacote”.</li><li><strong><strong>Encontrar o arquivo <em><em>programmers.txt</em></em></strong></strong><br />Dentro da pasta de instalação da Arduino IDE, deverá estar em <code>hardware\arduino\avr</code>.<br />Ex.: <code>C:\Arquivos de Programas (x86)\Arduino\hardware\arduino\avr\programmers.txt</code> (Windows); <code>/Applications/Arduino.app/Contents/Java/hardware/arduino/avr/programmers.txt</code>(macOS).</li><li><strong><strong>Adicionar a configuração para usar o Arduino Leonardo como ISP</strong></strong><br />Colocar as linhas a seguir no final do arquivo.</li></ol><pre><code>leonardoisp.name=Leonardo as ISP
leonardoisp.communication=serial
leonardoisp.protocol=arduino
leonardoisp.speed=19200
leonardoisp.program.protocol=arduino
leonardoisp.program.speed=19200
leonardoisp.program.tool=avrdude
leonardoisp.program.extra_params=-P{serial.port} -b{program.speed}
</code></pre>
<p>E para finalizar, instalamos o pacote <strong><strong>attiny</strong></strong>, do desenvolvedor <a href="https://github.com/damellis" rel="noopener">David Mellis</a>, na Arduino IDE:</p><ol><li><strong><strong>Adicionar a URL ao Gerenciador de Placas</strong></strong><br />Em <code><strong><strong>Arquivo</strong></strong> &gt; <strong><strong>Preferências</strong></strong></code> (<code><strong><strong>Arduino</strong></strong> &gt; <strong><strong>Preferências</strong></strong></code> no macOS), colar o endereço a seguir no campo “URLs Adicionais de Gerenciadores de Placas”.<br /><code><a href="https://raw.githubusercontent.com/damellis/attiny/ide-1.6.x-boards-manager/package_damellis_attiny_index.json" rel="noopener">https://raw.githubusercontent.com/damellis/attiny/ide-1.6.x-boards-manager/package_damellis_attiny_index.json</a></code></li><li><strong><strong>Abrir o Gerenciador de Placas da Arduino IDE</strong></strong><br />Ele se encontra em <code><strong><strong>Ferramentas</strong></strong> &gt; <strong><strong>Placa</strong></strong> &gt; <strong><strong>Gerenciador de Placas</strong></strong></code>.</li><li><strong><strong>Pesquisar por “attiny”</strong></strong><br />Basta digitar o nome na caixa de busca na parte superior da janela do gerenciador.</li><li><strong><strong>Instalar a última versão do pacote <em><em>attiny by David A. Mellis</em></em></strong></strong><br />Clicar sobre o elemento, certificar-se de que a versão mais recente está selecionada na caixa de seleção e clicar em “Instalar”.</li></ol><figure class="kg-card kg-image-card kg-card-hascaption"><figcaption>Instalação do pacote attiny pelo Gerenciador de Placas da Arduino IDE</figcaption></figure><p>Agora estamos prontos para fazer as ligações e começar a interagir com o ATtiny85. Segue o esquema.</p><figure class="kg-card kg-image-card kg-card-hascaption"><figcaption>Esquema de ligação do Arduino Leonardo com o ATtiny85</figcaption></figure><p>Com os fios ligados e o Arduino Leonardo conectado à porta USB do computador, abrimos a Arduino IDE, e, no menu “Ferramentas”, selecionamos as opções corretas de placa, processador, porta, <em><em>clock</em></em> e programador.</p><p>Para rodar o código compilado pela Arduino IDE, o chip precisa do <em><em>bootloader </em></em>adequado. Felizmente, para gravá-lo, basta clicar em “Gravar Bootloader”, ainda no menu “Ferramentas”. Isto também deve ser feito sempre que mudarmos o <em><em>clock</em></em>, para registrar no ATtiny85 o novo parâmetro.</p><figure class="kg-card kg-image-card kg-card-hascaption"><figcaption>Menu “Ferramentas” da Arduino IDE</figcaption></figure><p>Sem uma fonte de <em><em>clock</em></em> externa, o ATtiny85 pode ser configurado para rodar a 1 MHz, 8 MHz ou 16 MHz (as opções que começam com “<em><em>Internal</em></em>” no menu da Arduino IDE). Com ela (“<em><em>External</em></em>”), pode-se escolher entre 8 MHz, 16 MHz ou 20 MHz.</p><p><strong><strong>Muita atenção aqui.</strong></strong> Se configurarmos o microcontrolador para usar uma fonte externa, ele não funcionará e não poderá ser reprogramado sem que ela esteja, de fato, presente. Portanto, cuidado.</p><p>Se houver algum erro ao gravar o <em><em>bootloader</em></em>, verifique a ligação entre a placa e o microcontrolador — não é difícil se enganar com os fios — e as opções escolhidas. Também é válido tentar desconectar e reconectar o Arduino Leonardo à porta USB, e até reinciar a Arduino IDE.</p><p>Agora, se a mensagem “gravação do bootloader concluída” for exibida, o ATtiny85 está pronto para receber o seu programa.</p><h2 id="pisca-pisca">Pisca-pisca</h2><p>Lembra do Blink, aquele <em><em>sketch</em></em> que vem pré-carregado e é basicamente o “Hello World” da programação de Arduinos?</p><p>Ele pode ser aberto na Arduino IDE, em <code><strong><strong>Arquivo</strong></strong> &gt; <strong><strong>Exemplos</strong></strong> &gt; <strong><strong>Basics</strong></strong> &gt; <strong><strong>Blink</strong></strong></code>, e, conforme sua própria descrição, o que ele faz é ligar um LED por um segundo, depois desligá-lo por mais um, e repetir indefinidamente.</p><p>A maioria dos Arduinos tem um LED embutido que pode ser usado com este <em><em>sketch</em></em>. O ATtiny85 não.</p><p>Portanto, se queremos usar o Blink para comprovar que o microcontrolador já está completamente preparado, vamos precisar de um LED e um resistor de pelo menos 220 Ohm.</p><p>Ligamos conforme o esquema e carregamos no ATtiny85 o código a seguir, tudo como você provavelmente já está esperando.</p><figure class="kg-card kg-image-card kg-card-hascaption"><figcaption>Sinta-se livre para trocar o Arduino por outra fonte de alimentação</figcaption></figure><pre><code>/*
  Blink
  Turns on an LED on for one second, then off for one second,
  repeatedly.
  This example code is in the public domain.
  modified 23 Dec 2016
  by Rodrigo Menezes (for Radialle)
  modified 8 May 2014
  by Scott Fitzgerald
  
  modified 2 Sep 2016
  by Arturo Guadalupi
*/
void setup() {
  pinMode(4, OUTPUT);
}
void loop() {
  digitalWrite(4, HIGH);
  delay(1000);
  digitalWrite(4, LOW);
  delay(1000);
}
</code></pre>
<p>Você poderia mudar o pino, claro. Bastaria ligar o resistor em outro, e alterar o <em><em>sketch</em></em> de acordo. Apenas lembre-se de que a numeração dos pinos no código é diferente da física: o pino ao lado do RESET, por exemplo, é o segundo, e no programa deve ser referido como 3.</p><p>Na dúvida, consulte o esquema da seção “Conhecendo o ATtiny85”, ou o <a href="http://www.atmel.com/images/atmel-2586-avr-8-bit-microcontroller-attiny25-attiny45-attiny85_datasheet.pdf" rel="noopener"><em><em>datasheet</em></em></a>.</p><h2 id="conclus-o">Conclusão</h2><p>O Arduino certamente continuará como a sua plataforma de prototipagem favorita, mas agora você já conhece uma alternativa para deixar os seus projetos muito melhores do que antes.</p><p>Há muito a ganhar explorando o universo dos microcontroladores, e espero que este texto tenha lhe servido bem como uma introdução a essa jornada.</p>

            </section>

        </article>
    </main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="https://radialle.github.io">Radialle</a> &copy; 2020</section>
        <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
    </footer>
</body>
</html>
